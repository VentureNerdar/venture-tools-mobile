import{s as F}from"./BDqzCwnP.js";import{A as I,g as A,z as E,y as H,b as o,aU as D,H as j,m as V,p as U,j as q,c as G,w as m,s as e,o as J,d as w,t as P,az as N}from"./CJVGzo24.js";import{I as K}from"./DrGbu7j2.js";import{H as M}from"./DfeQPru4.js";import{s as O}from"./BmteebCk.js";import{s as Q}from"./DPLhavtu.js";import{a as W,s as X}from"./C1IScSLr.js";import{s as Y}from"./B7zuvm78.js";import{s as Z}from"./DWTRS4w3.js";import"./lvnqdlSG.js";/* empty css        *//* empty css        */import{u as x}from"./DECEjZPt.js";import{u as R}from"./BmVm5dzA.js";import{u as ee}from"./BVPXK9nR.js";import{u as ae,R as le}from"./DjSXyAZa.js";import{u as B}from"./BIzZP0jH.js";import{u as te}from"./DIjtFsju.js";import"./DuWVuEts.js";import"./Bf4hYtEl.js";import"./6XK8G8Gr.js";import"./D1uZQjJr.js";import"./ZkdsFaNX.js";import"./BoHWtOdR.js";import"./j8lHVsrf.js";import"./BttZGFy9.js";import"./BhuWYpfo.js";import"./CksZ33d2.js";const[oe,z]=I("tag"),ne={size:String,mark:Boolean,show:H,type:E("default"),color:String,plain:Boolean,round:Boolean,textColor:String,closeable:Boolean};var re=A({name:oe,props:ne,emits:["close"],setup(s,{slots:h,emit:t}){const k=i=>{i.stopPropagation(),t("close",i)},u=()=>s.plain?{color:s.textColor||s.color,borderColor:s.color}:{color:s.textColor,background:s.color},c=()=>{var i;const{type:g,mark:_,plain:l,round:C,size:v,closeable:y}=s,f={mark:_,plain:l,round:C};v&&(f[v]=v);const n=y&&o(K,{name:"cross",class:[z("close"),M],onClick:k},null);return o("span",{style:u(),class:z([f,g])},[(i=h.default)==null?void 0:i.call(h),n])};return()=>o(D,{name:s.closeable?"van-fade":void 0},{default:()=>[s.show?c():null]})}});const Ae=A({__name:"profile",setup(s){const h=B(),t=te(),k=j(),u=x(),c=V(!1),i=V([]),g=V(""),_={roles:U(()=>ee().userRoles),auth:x(),languages:R().languages},l=V({id:null,name:"",username:"",email:"",phone_number:"",biography:"",preferred_language_id:"",user_role_id:null,contact_id:null}),C=()=>{l.value.contact_id&&k.push({path:"/createForm",query:{moduleName:"Contacts",id:l.value.contact_id}})},v=U(()=>R().languages.map(n=>({text:n.name,value:n.id})));q(async()=>{if(await h.loadFromSecureStorage(),await u.loadFromSecureStorage(),u.authUser&&(console.log("Auth User ",u.authUser),l.value={...u.authUser},l.value.preferred_language_id)){const n=_.languages.find(a=>a.id===l.value.preferred_language_id);n&&(i.value=[n.id],g.value=n.name,B().setUserPreferredLanguage(n))}});const y=U(()=>{var n;return(n=_.roles.value.find(a=>a.id===l.value.user_role_id))==null?void 0:n.label}),f={handle:{click:{logout:async()=>{await x().logout(),X({type:"success",message:"See you again!",duration:2e3})},confirmLanguage:({selectedOptions:n})=>{c.value=!1;const a=n[0];l.value.preferred_language_id=a.value,g.value=a.text,i.value=[a.value]},update:async()=>{var p;await ae(le.USERS,(p=u.authUser)==null?void 0:p.id).save(l.value);const d={...u.authUser,...l.value};u.authUser=d,localStorage.setItem("authUser",JSON.stringify(d));const b=_.languages.find(S=>S.id===l.value.preferred_language_id);b&&B().setUserPreferredLanguage(b)}}}};return(n,a)=>{const d=F,b=re,p=O,S=Q,T=W,L=Y,$=Z;return J(),G("div",null,[o($,null,{default:m(()=>[o(d,{modelValue:e(l).name,"onUpdate:modelValue":a[0]||(a[0]=r=>e(l).name=r),label:e(t).translate("name"),placeholder:e(t).translate("name")},null,8,["modelValue","label","placeholder"]),o(p,{title:e(t).translate("user_role")},{value:m(()=>[o(b,{type:"primary"},{default:m(()=>[w(P(e(y)),1)]),_:1})]),_:1},8,["title"]),o(d,{modelValue:e(l).username,"onUpdate:modelValue":a[1]||(a[1]=r=>e(l).username=r),label:e(t).translate("username"),placeholder:e(t).translate("username"),readonly:""},null,8,["modelValue","label","placeholder"]),o(d,{modelValue:e(l).email,"onUpdate:modelValue":a[2]||(a[2]=r=>e(l).email=r),label:e(t).translate("email"),placeholder:e(t).translate("email")},null,8,["modelValue","label","placeholder"]),o(d,{modelValue:e(l).phone_number,"onUpdate:modelValue":a[3]||(a[3]=r=>e(l).phone_number=r),label:e(t).translate("phone"),placeholder:e(t).translate("phone")},null,8,["modelValue","label","placeholder"]),o(d,{modelValue:e(l).biography,"onUpdate:modelValue":a[4]||(a[4]=r=>e(l).biography=r),label:e(t).translate("biography"),placeholder:e(t).translate("biography")},null,8,["modelValue","label","placeholder"]),o(p,{title:e(t).translate("contact_profile"),"is-link":!!e(l).contact_id,value:e(l).contact_id?e(t).translate("go_to_contact_profile"):e(t).translate("no_contact_profile"),onClick:C},null,8,["title","is-link","value"]),o(d,{modelValue:e(g),"onUpdate:modelValue":a[5]||(a[5]=r=>N(g)?g.value=r:null),label:e(t).translate("language"),placeholder:e(t).translate("language"),"is-link":"",readonly:"",onClick:a[6]||(a[6]=r=>c.value=!0)},null,8,["modelValue","label","placeholder"]),o(T,{show:e(c),"onUpdate:show":a[8]||(a[8]=r=>N(c)?c.value=r:null),position:"bottom",round:""},{default:m(()=>[o(S,{"model-value":e(i),title:"Languages",columns:e(v),onCancel:a[7]||(a[7]=r=>c.value=!1),onConfirm:f.handle.click.confirmLanguage},null,8,["model-value","columns","onConfirm"])]),_:1},8,["show"]),o(p,null,{default:m(()=>[o(L,{type:"primary",block:"",size:"small",onClick:f.handle.click.update},{default:m(()=>[w(P(e(t).translate("update")),1)]),_:1},8,["onClick"])]),_:1})]),_:1}),o($,{title:e(t).translate("authentication")},{default:m(()=>[o(p,{"is-link":"",title:e(t).translate("change_password")},null,8,["title"]),o(p,{title:e(t).translate("log_out")},{value:m(()=>[o(L,{type:"danger",size:"mini",plain:"",block:"",onClick:f.handle.click.logout},{default:m(()=>[w(P(e(t).translate("log_out")),1)]),_:1},8,["onClick"])]),_:1},8,["title"])]),_:1},8,["title"])])}}});export{Ae as default};
