import{s as I}from"./0pvGEDWg.js";import{q as R,g as L,z as T,y as z,b as o,aT as A,m as h,s as V,H as E,c as H,w as i,l as e,o as D,d as C,t as k,aB as P}from"./DSRRTXY0.js";import{I as F}from"./BcQqayPu.js";import{H as J}from"./DfeQPru4.js";import{s as O}from"./MteXtcWH.js";import{s as q}from"./DllOZ5kY.js";import{b as G,s as K}from"./DYh-pV2H.js";import{s as M}from"./ur_VACmx.js";import{s as j}from"./BnmBTv-t.js";import"./CX4x1NNd.js";/* empty css        *//* empty css        */import{u as y}from"./DRHNE0eS.js";import{u as w}from"./BfP4sV-O.js";import{u as Q}from"./BvJSw2t0.js";import{u as W,R as X}from"./CAZ3tvf_.js";import{u as x}from"./Dbq6bm_i.js";import{u as Y}from"./X9qNQbWD.js";import"./BVuLz1V8.js";import"./BgJQGM5x.js";import"./BrLGy7Au.js";import"./CezKD8Jt.js";import"./DZMPMdYR.js";import"./C7GL2vS7.js";import"./CX1sPtrm.js";import"./2_l4ffRN.js";import"./Cjyzoxt_.js";const[Z,B]=R("tag"),ee={size:String,mark:Boolean,show:z,type:T("default"),color:String,plain:Boolean,round:Boolean,textColor:String,closeable:Boolean};var ae=L({name:Z,props:ee,emits:["close"],setup(u,{slots:t,emit:m}){const f=l=>{l.stopPropagation(),m("close",l)},c=()=>u.plain?{color:u.textColor||u.color,borderColor:u.color}:{color:u.textColor,background:u.color},d=()=>{var l;const{type:b,mark:v,plain:_,round:r,size:a,closeable:s}=u,g={mark:v,plain:_,round:r};a&&(g[a]=a);const p=s&&o(F,{name:"cross",class:[B("close"),J],onClick:f},null);return o("span",{style:c(),class:B([g,b])},[(l=t.default)==null?void 0:l.call(t),p])};return()=>o(A,{name:u.closeable?"van-fade":void 0},{default:()=>[u.show?d():null]})}});const Be=L({__name:"profile",setup(u){const t=Y(),m=h(!1),f=h([]),c=h(""),d={roles:V(()=>Q().userRoles),auth:y(),languages:w().languages},l=h({id:null,name:"",username:"",email:"",phone_number:"",biography:"",preferred_language_id:"",user_role_id:null}),b=V(()=>w().languages.map(r=>({text:r.name,value:r.id})));E(()=>{if(d.auth.authUser&&(console.log("authStore",d.auth.authUser),l.value={...d.auth.authUser},l.value.preferred_language_id)){const r=d.languages.find(a=>a.id===l.value.preferred_language_id);r&&(f.value=[r.id],c.value=r.name,x().setUserPreferredLanguage(r))}});const v=V(()=>"Church Planter"),_={handle:{click:{logout:async()=>{await y().logout(),K({type:"success",message:"See you again!",duration:2e3})},confirmLanguage:({selectedOptions:r})=>{m.value=!1;const a=r[0];l.value.preferred_language_id=a.value,c.value=a.text,f.value=[a.value]},update:async()=>{await W(X.USERS,d.auth.authUser.id).save(l.value);const s={...JSON.parse(localStorage.getItem("authUser")||"{}"),...l.value};y().authUser=s,localStorage.setItem("authUser",JSON.stringify(s));const g=d.languages.find(p=>p.id===l.value.preferred_language_id);g&&x().setUserPreferredLanguage(g)}}}};return(r,a)=>{const s=I,g=ae,p=O,$=q,N=G,S=M,U=j;return D(),H("div",null,[o(U,null,{default:i(()=>[o(s,{modelValue:e(l).name,"onUpdate:modelValue":a[0]||(a[0]=n=>e(l).name=n),label:e(t).translate("name"),placeholder:e(t).translate("name")},null,8,["modelValue","label","placeholder"]),o(p,{title:e(t).translate("user_role")},{value:i(()=>[o(g,{type:"primary"},{default:i(()=>[C(k(e(v)),1)]),_:1})]),_:1},8,["title"]),o(s,{modelValue:e(l).username,"onUpdate:modelValue":a[1]||(a[1]=n=>e(l).username=n),label:e(t).translate("username"),placeholder:e(t).translate("username"),readonly:""},null,8,["modelValue","label","placeholder"]),o(s,{modelValue:e(l).email,"onUpdate:modelValue":a[2]||(a[2]=n=>e(l).email=n),label:e(t).translate("email"),placeholder:e(t).translate("email")},null,8,["modelValue","label","placeholder"]),o(s,{modelValue:e(l).phone_number,"onUpdate:modelValue":a[3]||(a[3]=n=>e(l).phone_number=n),label:e(t).translate("phone"),placeholder:e(t).translate("phone")},null,8,["modelValue","label","placeholder"]),o(s,{modelValue:e(l).biography,"onUpdate:modelValue":a[4]||(a[4]=n=>e(l).biography=n),label:e(t).translate("biography"),placeholder:e(t).translate("biography")},null,8,["modelValue","label","placeholder"]),o(s,{modelValue:e(c),"onUpdate:modelValue":a[5]||(a[5]=n=>P(c)?c.value=n:null),label:e(t).translate("language"),placeholder:e(t).translate("language"),"is-link":"",readonly:"",onClick:a[6]||(a[6]=n=>m.value=!0)},null,8,["modelValue","label","placeholder"]),o(N,{show:e(m),"onUpdate:show":a[8]||(a[8]=n=>P(m)?m.value=n:null),position:"bottom",round:""},{default:i(()=>[o($,{"model-value":e(f),title:"Languages",columns:e(b),onCancel:a[7]||(a[7]=n=>m.value=!1),onConfirm:_.handle.click.confirmLanguage},null,8,["model-value","columns","onConfirm"])]),_:1},8,["show"]),o(p,null,{default:i(()=>[o(S,{type:"primary",block:"",size:"small",onClick:_.handle.click.update},{default:i(()=>[C(k(e(t).translate("update")),1)]),_:1},8,["onClick"])]),_:1})]),_:1}),o(U,{title:e(t).translate("authentication")},{default:i(()=>[o(p,{"is-link":"",title:e(t).translate("change_password")},null,8,["title"]),o(p,{title:e(t).translate("log_out")},{value:i(()=>[o(S,{type:"danger",size:"mini",plain:"",block:"",onClick:_.handle.click.logout},{default:i(()=>[C(k(e(t).translate("log_out")),1)]),_:1},8,["onClick"])]),_:1},8,["title"])]),_:1},8,["title"])])}}});export{Be as default};
