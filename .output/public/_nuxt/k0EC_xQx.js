import{s as W}from"./C4T9sjoj.js";import{x as I,a7 as U,av as M,az as P,bb as X,a8 as D,A as T,L as F,b5 as Y,b as n,at as q,a$ as Z,aA as ee,m as z,as as ae,aH as te,r as V,l as oe,a5 as le,aQ as ne,j as se,n as O,c as re,w as y,Q as a,o as ie,d as B,t as L,ao as R}from"./xvOr7JZp.js";import{I as Q}from"./Bvediuhp.js";import{H as ue}from"./DRbOzoBI.js";import{s as ce}from"./BEIImhDX.js";import{s as de}from"./DdnqA1Xo.js";import{P as me,m as pe,u as fe,a as ge,s as A}from"./mvQjSHbN.js";import{s as ve}from"./DkkZvEGh.js";import{s as ye}from"./pS-YWweU.js";import"./B2ppoJu3.js";/* empty css        *//* empty css        */import{u as H}from"./DfEHeQ8K.js";import{u as he}from"./EJyoZEUM.js";import{u as ke}from"./C8QzwJhd.js";import{u as _e,R as be}from"./BzVUPfdH.js";import{u as Ce}from"./Be2TrkDc.js";import{L as we}from"./C_OBfR3-.js";import{w as Se}from"./uBGtmrZ3.js";import"./naXCj4v2.js";import"./nKeBUtfN.js";import"./DY0N4hfE.js";import"./Crs290K3.js";import"./eScSZUk8.js";import"./D9jaufuE.js";import"./BdZ7JDdr.js";import"./DUvFn_Rb.js";import"./xnOEHO0W.js";let S=0;function Ve(e){e?(S||document.body.classList.add("van-toast--unclickable"),S++):S&&(S--,S||document.body.classList.remove("van-toast--unclickable"))}const[Pe,k]=D("toast"),xe=["show","overlay","teleport","transition","overlayClass","overlayStyle","closeOnClickOverlay","zIndex"],Ue={icon:String,show:Boolean,type:P("text"),overlay:Boolean,message:U,iconSize:U,duration:X(2e3),position:P("middle"),teleport:[String,Object],wordBreak:String,className:M,iconPrefix:String,transition:P("van-fade"),loadingType:String,forbidClick:Boolean,overlayClass:M,overlayStyle:Object,closeOnClick:Boolean,closeOnClickOverlay:Boolean,zIndex:U};var G=I({name:Pe,props:Ue,emits:["update:show"],setup(e,{emit:t,slots:p}){let d,m=!1;const g=()=>{const i=e.show&&e.forbidClick;m!==i&&(m=i,Ve(m))},r=i=>t("update:show",i),f=()=>{e.closeOnClick&&r(!1)},l=()=>clearTimeout(d),b=()=>{const{icon:i,type:u,iconSize:s,iconPrefix:o,loadingType:v}=e;if(i||u==="success"||u==="fail")return n(Q,{name:i||u,size:s,class:k("icon"),classPrefix:o},null);if(u==="loading")return n(we,{class:k("loading"),size:s,type:v},null)},C=()=>{const{type:i,message:u}=e;if(p.message)return n("div",{class:k("text")},[p.message()]);if(ee(u)&&u!=="")return i==="html"?n("div",{key:0,class:k("text"),innerHTML:String(u)},null):n("div",{class:k("text")},[u])};return T(()=>[e.show,e.forbidClick],g),T(()=>[e.show,e.type,e.message,e.duration],()=>{l(),e.show&&e.duration>0&&(d=setTimeout(()=>{r(!1)},e.duration))}),F(g),Y(g),()=>n(me,q({class:[k([e.position,e.wordBreak==="normal"?"break-normal":e.wordBreak,{[e.type]:!e.icon}]),e.className],lockScroll:!1,onClick:f,onClosed:l,"onUpdate:show":r},Z(e,xe)),{default:()=>[b(),C()]})}});const Oe={icon:"",type:"text",message:"",className:"",overlay:!1,onClose:void 0,onOpened:void 0,duration:2e3,teleport:"body",iconSize:void 0,iconPrefix:void 0,position:"middle",transition:"van-fade",forbidClick:!1,loadingType:void 0,overlayClass:"",overlayStyle:void 0,closeOnClick:!1,closeOnClickOverlay:!1};let _=[],Be=!1,j=z({},Oe);const Le=new Map;function J(e){return te(e)?e:{message:e}}function Te(){const{instance:e}=pe({setup(){const t=V(""),{open:p,state:d,close:m,toggle:g}=fe(),r=()=>{},f=()=>n(G,q(d,{onClosed:r,"onUpdate:show":g}),null);return T(t,l=>{d.message=l}),oe().render=f,{open:p,close:m,message:t}}});return e}function Ie(){if(!_.length||Be){const e=Te();_.push(e)}return _[_.length-1]}function ze(e={}){if(!ae)return{};const t=Ie(),p=J(e);return t.open(z({},j,Le.get(p.type||j.type),p)),t}const $e=e=>t=>ze(z({type:e},J(t))),Ne=$e("loading"),Me=e=>{_.length&&_[0].close()};Se(G);const[Re,E]=D("tag"),Ae={size:String,mark:Boolean,show:le,type:P("default"),color:String,plain:Boolean,round:Boolean,textColor:String,closeable:Boolean};var He=I({name:Re,props:Ae,emits:["close"],setup(e,{slots:t,emit:p}){const d=r=>{r.stopPropagation(),p("close",r)},m=()=>e.plain?{color:e.textColor||e.color,borderColor:e.color}:{color:e.textColor,background:e.color},g=()=>{var r;const{type:f,mark:l,plain:b,round:C,size:i,closeable:u}=e,s={mark:l,plain:b,round:C};i&&(s[i]=i);const o=u&&n(Q,{name:"cross",class:[E("close"),ue],onClick:d},null);return n("span",{style:m(),class:E([s,f])},[(r=t.default)==null?void 0:r.call(t),o])};return()=>n(ne,{name:e.closeable?"van-fade":void 0},{default:()=>[e.show?g():null]})}});const ga=I({__name:"profile",setup(e){const t=Ce(),p=se(),d=H(),m=V(!1),g=V([]),r=V(""),f={roles:O(()=>ke().userRoles),auth:H(),languageStore:he()},l=V({id:null,name:"",username:"",email:"",phone_number:"",biography:"",preferred_language_id:"",user_role_id:null,contact_id:null}),b=()=>{l.value.contact_id&&p.push({path:"/createForm",query:{moduleName:"Contacts",id:l.value.contact_id}})},C=O(()=>f.languageStore.languages.map(s=>({text:s.name,value:s.id})));F(async()=>{if(d.authUser&&(l.value={...d.authUser},l.value.preferred_language_id)){const s=f.languageStore.languages.find(o=>o.id===l.value.preferred_language_id);s&&(g.value=[s.id],r.value=s.name,f.languageStore.setUserPreferredLanguage(s))}});const i=O(()=>{var s;return(s=f.roles.value.find(o=>o.id===l.value.user_role_id))==null?void 0:s.label}),u={handle:{click:{logout:async()=>{Ne({message:"Logging out...",forbidClick:!1,duration:0,overlay:!1,position:"middle",loadingType:"spinner"});try{await d.logout(),p.replace("/"),A({type:"success",message:"See you again!",duration:2e3})}catch{A({type:"danger",message:"Logout failed. Please try again",duration:2e3})}finally{Me()}},confirmLanguage:({selectedOptions:s})=>{m.value=!1;const o=s[0];l.value.preferred_language_id=o.value,r.value=o.text,g.value=[o.value]},update:async()=>{var h;await(await _e(be.USERS,(h=d.authUser)==null?void 0:h.id)).save(l.value);const v={...d.authUser,...l.value};d.authUser=v,localStorage.setItem("authUser",JSON.stringify(v));const w=f.languageStore.languages.find(x=>x.id===l.value.preferred_language_id);w&&f.languageStore.setUserPreferredLanguage(w)}}}};return(s,o)=>{const v=W,w=He,h=ce,x=de,K=ge,$=ve,N=ye;return ie(),re("div",null,[n(N,null,{default:y(()=>[n(v,{modelValue:a(l).name,"onUpdate:modelValue":o[0]||(o[0]=c=>a(l).name=c),label:a(t).translate("name"),placeholder:a(t).translate("name")},null,8,["modelValue","label","placeholder"]),n(h,{title:a(t).translate("user_role")},{value:y(()=>[n(w,{type:"primary"},{default:y(()=>[B(L(a(i)),1)]),_:1})]),_:1},8,["title"]),n(v,{modelValue:a(l).username,"onUpdate:modelValue":o[1]||(o[1]=c=>a(l).username=c),label:a(t).translate("username"),placeholder:a(t).translate("username"),readonly:""},null,8,["modelValue","label","placeholder"]),n(v,{modelValue:a(l).email,"onUpdate:modelValue":o[2]||(o[2]=c=>a(l).email=c),label:a(t).translate("email"),placeholder:a(t).translate("email")},null,8,["modelValue","label","placeholder"]),n(v,{modelValue:a(l).phone_number,"onUpdate:modelValue":o[3]||(o[3]=c=>a(l).phone_number=c),label:a(t).translate("phone"),placeholder:a(t).translate("phone")},null,8,["modelValue","label","placeholder"]),n(v,{modelValue:a(l).biography,"onUpdate:modelValue":o[4]||(o[4]=c=>a(l).biography=c),label:a(t).translate("biography"),placeholder:a(t).translate("biography")},null,8,["modelValue","label","placeholder"]),n(h,{title:a(t).translate("contact_profile"),"is-link":!!a(l).contact_id,value:a(l).contact_id?a(t).translate("go_to_contact_profile"):a(t).translate("no_contact_profile"),onClick:b},null,8,["title","is-link","value"]),n(v,{modelValue:a(r),"onUpdate:modelValue":o[5]||(o[5]=c=>R(r)?r.value=c:null),label:a(t).translate("language"),placeholder:a(t).translate("language"),"is-link":"",readonly:"",onClick:o[6]||(o[6]=c=>m.value=!0)},null,8,["modelValue","label","placeholder"]),n(K,{show:a(m),"onUpdate:show":o[8]||(o[8]=c=>R(m)?m.value=c:null),position:"bottom",round:""},{default:y(()=>[n(x,{"model-value":a(g),title:"Languages",columns:a(C),onCancel:o[7]||(o[7]=c=>m.value=!1),onConfirm:u.handle.click.confirmLanguage},null,8,["model-value","columns","onConfirm"])]),_:1},8,["show"]),n(h,null,{default:y(()=>[n($,{type:"primary",block:"",size:"small",onClick:u.handle.click.update},{default:y(()=>[B(L(a(t).translate("update")),1)]),_:1},8,["onClick"])]),_:1})]),_:1}),n(N,{title:a(t).translate("authentication")},{default:y(()=>[n(h,{"is-link":"",title:a(t).translate("change_password")},null,8,["title"]),n(h,{title:a(t).translate("log_out")},{value:y(()=>[n($,{type:"danger",size:"mini",plain:"",block:"",onClick:u.handle.click.logout},{default:y(()=>[B(L(a(t).translate("log_out")),1)]),_:1},8,["onClick"])]),_:1},8,["title"])]),_:1},8,["title"])])}}});export{ga as default};
