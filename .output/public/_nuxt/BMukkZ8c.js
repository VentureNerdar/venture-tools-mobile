import{s as I}from"./B4FTMI9E.js";import{A as T,g as $,z,y as E,b as o,aV as H,H as F,m as h,p as C,j as D,c as J,w as d,s as e,o as O,d as y,t as U,aA as x}from"./BcM8nbUc.js";import{I as j}from"./BZvMXGx7.js";import{H as q}from"./DfeQPru4.js";import{s as G}from"./BqV7Ghxx.js";import{s as K}from"./CTuMp1Np.js";import{a as M,s as Q}from"./CbYSZLda.js";import{s as W}from"./DLRAkl61.js";import{s as X}from"./sm_BGTV-.js";import"./C1587OLP.js";/* empty css        *//* empty css        */import{u as S}from"./DnEc7Rgu.js";import{u as B}from"./BIZiQy_b.js";import{u as Y}from"./ZKtkBm5j.js";import{u as Z,R as ee}from"./bH_x2CWL.js";import{u as L}from"./ZXv_2jnj.js";import{u as ae}from"./DbRHh0Ao.js";import"./Czghp9T7.js";import"./B7B4zphO.js";import"./1cSE0txk.js";import"./wzS7IZBv.js";import"./DQZbwPUK.js";import"./D4r7wC-U.js";import"./CQbdaxH3.js";import"./B4-co7sM.js";import"./DGqFMbKC.js";import"./C2uxVfP1.js";const[le,N]=T("tag"),te={size:String,mark:Boolean,show:E,type:z("default"),color:String,plain:Boolean,round:Boolean,textColor:String,closeable:Boolean};var oe=$({name:le,props:te,emits:["close"],setup(i,{slots:l,emit:v}){const m=s=>{s.stopPropagation(),v("close",s)},f=()=>i.plain?{color:i.textColor||i.color,borderColor:i.color}:{color:i.textColor,background:i.color},c=()=>{var s;const{type:t,mark:b,plain:V,round:k,size:p,closeable:n}=i,a={mark:b,plain:V,round:k};p&&(a[p]=p);const u=n&&o(j,{name:"cross",class:[N("close"),q],onClick:m},null);return o("span",{style:f(),class:N([a,t])},[(s=l.default)==null?void 0:s.call(l),u])};return()=>o(H,{name:i.closeable?"van-fade":void 0},{default:()=>[i.show?c():null]})}});const Ae=$({__name:"profile",setup(i){const l=ae(),v=F(),m=h(!1),f=h([]),c=h(""),s={roles:C(()=>Y().userRoles),auth:S(),languages:B().languages},t=h({id:null,name:"",username:"",email:"",phone_number:"",biography:"",preferred_language_id:"",user_role_id:null,contact_id:null}),b=()=>{t.value.contact_id&&v.push({path:"/createForm",query:{moduleName:"Contacts",id:t.value.contact_id}})},V=C(()=>B().languages.map(n=>({text:n.name,value:n.id})));D(async()=>{if(s.auth.authUser&&(console.log("Auth User ",s.auth.authUser),t.value={...s.auth.authUser},t.value.preferred_language_id)){const n=s.languages.find(a=>a.id===t.value.preferred_language_id);n&&(f.value=[n.id],c.value=n.name,L().setUserPreferredLanguage(n))}});const k=C(()=>{var n;return(n=s.roles.value.find(a=>a.id===t.value.user_role_id))==null?void 0:n.label}),p={handle:{click:{logout:async()=>{await S().logout(),Q({type:"success",message:"See you again!",duration:2e3})},confirmLanguage:({selectedOptions:n})=>{m.value=!1;const a=n[0];t.value.preferred_language_id=a.value,c.value=a.text,f.value=[a.value]},update:async()=>{await Z(ee.USERS,s.auth.authUser.id).save(t.value);const u={...JSON.parse(localStorage.getItem("authUser")||"{}"),...t.value};S().authUser=u,localStorage.setItem("authUser",JSON.stringify(u));const _=s.languages.find(g=>g.id===t.value.preferred_language_id);_&&L().setUserPreferredLanguage(_)}}}};return(n,a)=>{const u=I,_=oe,g=G,A=K,R=M,P=W,w=X;return O(),J("div",null,[o(w,null,{default:d(()=>[o(u,{modelValue:e(t).name,"onUpdate:modelValue":a[0]||(a[0]=r=>e(t).name=r),label:e(l).translate("name"),placeholder:e(l).translate("name")},null,8,["modelValue","label","placeholder"]),o(g,{title:e(l).translate("user_role")},{value:d(()=>[o(_,{type:"primary"},{default:d(()=>[y(U(e(k)),1)]),_:1})]),_:1},8,["title"]),o(u,{modelValue:e(t).username,"onUpdate:modelValue":a[1]||(a[1]=r=>e(t).username=r),label:e(l).translate("username"),placeholder:e(l).translate("username"),readonly:""},null,8,["modelValue","label","placeholder"]),o(u,{modelValue:e(t).email,"onUpdate:modelValue":a[2]||(a[2]=r=>e(t).email=r),label:e(l).translate("email"),placeholder:e(l).translate("email")},null,8,["modelValue","label","placeholder"]),o(u,{modelValue:e(t).phone_number,"onUpdate:modelValue":a[3]||(a[3]=r=>e(t).phone_number=r),label:e(l).translate("phone"),placeholder:e(l).translate("phone")},null,8,["modelValue","label","placeholder"]),o(u,{modelValue:e(t).biography,"onUpdate:modelValue":a[4]||(a[4]=r=>e(t).biography=r),label:e(l).translate("biography"),placeholder:e(l).translate("biography")},null,8,["modelValue","label","placeholder"]),o(g,{title:e(l).translate("contact_profile"),"is-link":!!e(t).contact_id,value:e(t).contact_id?e(l).translate("go_to_contact_profile"):e(l).translate("no_contact_profile"),onClick:b},null,8,["title","is-link","value"]),o(u,{modelValue:e(c),"onUpdate:modelValue":a[5]||(a[5]=r=>x(c)?c.value=r:null),label:e(l).translate("language"),placeholder:e(l).translate("language"),"is-link":"",readonly:"",onClick:a[6]||(a[6]=r=>m.value=!0)},null,8,["modelValue","label","placeholder"]),o(R,{show:e(m),"onUpdate:show":a[8]||(a[8]=r=>x(m)?m.value=r:null),position:"bottom",round:""},{default:d(()=>[o(A,{"model-value":e(f),title:"Languages",columns:e(V),onCancel:a[7]||(a[7]=r=>m.value=!1),onConfirm:p.handle.click.confirmLanguage},null,8,["model-value","columns","onConfirm"])]),_:1},8,["show"]),o(g,null,{default:d(()=>[o(P,{type:"primary",block:"",size:"small",onClick:p.handle.click.update},{default:d(()=>[y(U(e(l).translate("update")),1)]),_:1},8,["onClick"])]),_:1})]),_:1}),o(w,{title:e(l).translate("authentication")},{default:d(()=>[o(g,{"is-link":"",title:e(l).translate("change_password")},null,8,["title"]),o(g,{title:e(l).translate("log_out")},{value:d(()=>[o(P,{type:"danger",size:"mini",plain:"",block:"",onClick:p.handle.click.logout},{default:d(()=>[y(U(e(l).translate("log_out")),1)]),_:1},8,["onClick"])]),_:1},8,["title"])]),_:1},8,["title"])])}}});export{Ae as default};
