import{s as N}from"./uc54E91V.js";import{j as I,g as B,s as R,q as A,b as t,aS as E,E as h,k as U,B as T,c as z,w as i,m as e,o as H,d as V,t as k,aA as w}from"./Dmm6Q3hy.js";import{H as D,I as F}from"./C4DoHFH8.js";import{s as J}from"./Di4dtHq4.js";import{s as O}from"./D3pSzwrq.js";import{b as j,s as q}from"./D2NdxRdZ.js";import{s as G}from"./27217Dvn.js";import{s as K}from"./D7AtN0sY.js";import"./C-izWNIt.js";/* empty css        */import{u as C}from"./C2KwVyO7.js";import{u as P}from"./AVDSkdFb.js";import{u as M}from"./Du2SL_ph.js";import{u as Q,R as W}from"./BFlRMGB0.js";import{u as X}from"./8Z8x03M_.js";import{u as Y}from"./B4f3Eu-Q.js";import"./pbhb1baf.js";import"./ObHFYt3N.js";import"./DUKeQHbg.js";import"./Bwn9jZ5r.js";import"./BuLzc7N1.js";import"./eq3yB9Uz.js";const[Z,x]=I("tag"),ee={size:String,mark:Boolean,show:A,type:R("default"),color:String,plain:Boolean,round:Boolean,textColor:String,closeable:Boolean};var ae=B({name:Z,props:ee,emits:["close"],setup(u,{slots:o,emit:m}){const g=l=>{l.stopPropagation(),m("close",l)},d=()=>u.plain?{color:u.textColor||u.color,borderColor:u.color}:{color:u.textColor,background:u.color},p=()=>{var l;const{type:b,mark:v,plain:f,round:n,size:a,closeable:s}=u,_={mark:v,plain:f,round:n};a&&(_[a]=a);const c=s&&t(F,{name:"cross",class:[x("close"),D],onClick:g},null);return t("span",{style:d(),class:x([_,b])},[(l=o.default)==null?void 0:l.call(o),c])};return()=>t(E,{name:u.closeable?"van-fade":void 0},{default:()=>[u.show?p():null]})}});const Se=B({__name:"profile",setup(u){const o=Y(),m=h(!1),g=h([]),d=h(""),p={roles:M().userRoles,auth:C()},l=h({id:null,name:"",username:"",email:"",phone_number:"",biography:"",preferred_language_id:"",user_role_id:null}),b=U(()=>P().languages.map(n=>({text:n.name,value:n.id})));T(()=>{if(p.auth.authUser&&(console.log("authStore",p.auth.authUser),l.value={...p.auth.authUser},l.value.preferred_language_id)){const n=P().languages.find(a=>a.id===l.value.preferred_language_id);n&&(g.value=[n.id],d.value=n.name,X().setUserPreferredLanguage(n))}});const v=U(()=>{var n;return(n=p.roles.find(a=>a.id===l.value.user_role_id))==null?void 0:n.label}),f={handle:{click:{logout:async()=>{await C().logout(),q({type:"success",message:"See you again!",duration:2e3})},confirmLanguage:({selectedOptions:n})=>{m.value=!1;const a=n[0];l.value.preferred_language_id=a.value,d.value=a.text,g.value=[a.value]},update:async()=>{await Q(W.USERS,p.auth.authUser.id).save(l.value);const s={...JSON.parse(localStorage.getItem("authUser")||"{}"),...l.value};C().authUser=s,localStorage.setItem("authUser",JSON.stringify(s))}}}};return(n,a)=>{const s=N,_=ae,c=J,$=O,L=j,y=G,S=K;return H(),z("div",null,[t(S,null,{default:i(()=>[t(s,{modelValue:e(l).name,"onUpdate:modelValue":a[0]||(a[0]=r=>e(l).name=r),label:e(o).translate("name"),placeholder:e(o).translate("name")},null,8,["modelValue","label","placeholder"]),t(c,{title:e(o).translate("user_role")},{value:i(()=>[t(_,{type:"primary"},{default:i(()=>[V(k(e(v)),1)]),_:1})]),_:1},8,["title"]),t(s,{modelValue:e(l).username,"onUpdate:modelValue":a[1]||(a[1]=r=>e(l).username=r),label:e(o).translate("username"),placeholder:e(o).translate("username"),readonly:""},null,8,["modelValue","label","placeholder"]),t(s,{modelValue:e(l).email,"onUpdate:modelValue":a[2]||(a[2]=r=>e(l).email=r),label:e(o).translate("email"),placeholder:e(o).translate("email")},null,8,["modelValue","label","placeholder"]),t(s,{modelValue:e(l).phone_number,"onUpdate:modelValue":a[3]||(a[3]=r=>e(l).phone_number=r),label:e(o).translate("phone"),placeholder:e(o).translate("phone")},null,8,["modelValue","label","placeholder"]),t(s,{modelValue:e(l).biography,"onUpdate:modelValue":a[4]||(a[4]=r=>e(l).biography=r),label:e(o).translate("biography"),placeholder:e(o).translate("biography")},null,8,["modelValue","label","placeholder"]),t(s,{modelValue:e(d),"onUpdate:modelValue":a[5]||(a[5]=r=>w(d)?d.value=r:null),label:e(o).translate("language"),placeholder:e(o).translate("language"),"is-link":"",readonly:"",onClick:a[6]||(a[6]=r=>m.value=!0)},null,8,["modelValue","label","placeholder"]),t(L,{show:e(m),"onUpdate:show":a[8]||(a[8]=r=>w(m)?m.value=r:null),position:"bottom",round:""},{default:i(()=>[t($,{"model-value":e(g),title:"Languages",columns:e(b),onCancel:a[7]||(a[7]=r=>m.value=!1),onConfirm:f.handle.click.confirmLanguage},null,8,["model-value","columns","onConfirm"])]),_:1},8,["show"]),t(c,null,{default:i(()=>[t(y,{type:"primary",block:"",size:"small",onClick:f.handle.click.update},{default:i(()=>[V(k(e(o).translate("update")),1)]),_:1},8,["onClick"])]),_:1})]),_:1}),t(S,{title:e(o).translate("authentication")},{default:i(()=>[t(c,{"is-link":"",title:e(o).translate("change_password")},null,8,["title"]),t(c,{title:e(o).translate("log_out")},{value:i(()=>[t(y,{type:"danger",size:"mini",plain:"",block:"",onClick:f.handle.click.logout},{default:i(()=>[V(k(e(o).translate("log_out")),1)]),_:1},8,["onClick"])]),_:1},8,["title"])]),_:1},8,["title"])])}}});export{Se as default};
