import{s as F}from"./Ctc7qOvh.js";import{q as R,r as y,j as E,v as U,R as w,P as A,D as I,G as x,c as J,b as V,w as W,o as q,d as b,t as D,U as B}from"./DX7L8mW0.js";import{R as u,u as H}from"./0Ud42BVA.js";import{u as g}from"./B5QHbL8n.js";import{u as S}from"./BtNk9jBy.js";import{u as C,a as k}from"./DMmvlFja.js";import{u as O}from"./DTLKgQJ7.js";import{s as _,a as P,S as $}from"./-v2XyxJZ.js";import{u as j}from"./Dc9-n7Wd.js";import{u as z}from"./2U1pBdZB.js";import{_ as K}from"./DlAUqK2U.js";import"./ZaMcrE34.js";import"./DkQH-hTN.js";import"./DBFB9YKp.js";import"./BbEgM1do.js";import"./CYA1mnle.js";import"./DRbOzoBI.js";import"./DlD6u9LM.js";import"./C0yiKs0t.js";import"./DVrzjvSN.js";import"./DvxMi5gK.js";import"./CP7Dlk6W.js";const Y=R("communities",()=>{const c=y({}),n=y({});return{communities:c,communityChecklists:n,loadFromSecureStorage:async()=>{try{const t=await _("communities");t.value&&(c.value=JSON.parse(t.value))}catch(t){console.log(t),c.value={}}try{const t=await _("communityChecklists");t.value&&(n.value=JSON.parse(t.value))}catch(t){console.log(t),n.value={}}},setCommunities:async t=>{c.value=t,await P("communities",JSON.stringify(t))},setCommunityChecklists:async t=>{n.value=t,await P("communityChecklists",JSON.stringify(t))}}}),Q={class:"wrap"},X=E({__name:"splash",setup(c){const n=U(),l=async(e,a)=>{try{const{value:i}=await $.get({key:e});return JSON.parse(i)}catch{return a}},f=e=>new Promise(a=>setTimeout(a,e)),o=w({completedModules:[],currentTaskText:"",defaultStoreOptions:{isPersist:!0},stores:{languages:g(),settings:S()},logoLoaded:!1,isLoading:!0}),t={all:!0},L=[["Languages",u.LANGUAGES,"languages",{...o.defaultStoreOptions,key:"languages",storeState:g().languages},{...t,with:JSON.stringify(["translations"])}],["Language Words",u.LANGUAGE_WORDS,"languageWords",{...o.defaultStoreOptions,key:"languageWords",storeState:g().words},t]],T=[["User Roles",u.USERS_ROLES,"userRoles",{...o.defaultStoreOptions,key:"userRoles",storeState:j().userRoles},{...t,whereNotIn:{key:"id",value:[1,2]}}],["Statuses",u.SETTINGS_STATUSES,"statuses",{...o.defaultStoreOptions,key:"statuses",storeState:S().statuses},t],["People Groups",u.PEOPLE_GROUPS,"peopleGroups",{...o.defaultStoreOptions,key:"peopleGroups",storeState:C().peopleGroups},t],["Communication Platforms",u.COMMUNICATION_PLATFORMS,"communicationPlatforms",{...o.defaultStoreOptions,key:"communicationPlatforms",storeState:O().communicationPlatforms},t],["Community Checklists",u.COMMUNITY_CHECKLISTS,"communityChecklists",{...o.defaultStoreOptions,key:"communityChecklists",storeState:Y().communityChecklists},t],["Faith Milestones",u.FAITH_MILESTONES,"faithMilestones",{...o.defaultStoreOptions,key:"faithMilestones",storeState:k().faithMilestones},t]],r=w({faithMilestoneStore:k(),settings:S(),peopleGroupStore:C(),languageStore:g(),communicationPlatformStore:O(),authStore:z()});A(async()=>{try{await M(),await r.authStore.loadFromSecureStorage(),await r.settings.loadFromSecureStorage(),await G();const e=r.authStore.authUser,a=r.settings.pinCode;if(!e){console.log("[Splash] No user found → redirecting to /welcome"),n.replace("/welcome");return}console.log("[Splash] Authenticated user:",e.email),await N(),e&&a?n.replace("/pin"):e&&e.first_time_login?n.push("/settings/security"):(console.log("[Splash] Finished preload → go to /landing"),n.replace("/landing"))}catch(e){console.error("[Splash] Initialization error:",e),n.replace("/welcome")}});const M=async()=>{for(const[e,a,i,m,p]of L){if(o.currentTaskText=`Fetching ${e}...`,await d(e,a,p,{...o.defaultStoreOptions,key:i,store:m}),e==="Languages")try{const s=await l("languages",[]);let h;s&&s.length&&(h=s.find(v=>v.locale==="en"),r.languageStore.setUserPreferredLanguage(h))}catch(s){console.error("Error reading languages from secure storage",s)}if(e==="Languages"){const s=JSON.parse(localStorage.getItem("languages")||"[]");r.languageStore.setLanguages(s)}if(e==="Language Words"){const s=JSON.parse(localStorage.getItem("languageWords")||"[]");r.languageStore.setWords(s)}}},N=async()=>{for(const[e,a,i,m,p]of T){if(o.currentTaskText=`Fetching ${e}...`,await d(e,a,p,{...o.defaultStoreOptions,key:i,store:m}),e==="Statuses"){const s=await l("statuses",[]);r.settings.setStatuses(s)}if(e==="Faith Milestones"){const s=await l("faithMilestones",[]);r.faithMilestoneStore.setFaithMilestones(s)}if(e==="People Groups"){const s=await l("peopleGroups",[]);r.peopleGroupStore.setPeopleGroups(s)}if(e==="Communication Platforms"){const s=await l("communicationPlatforms",[]);r.communicationPlatformStore.setCommunicationPlatforms(s)}await f(200),o.logoLoaded||(o.logoLoaded=!0)}I("/landing")},d=async(e,a,i,m)=>{await(await H(a)).browse(i,m),o.completedModules.push(e),e==="Faith Milestones"&&(o.currentTaskText="Redirecting . . . ")},G=async()=>new Promise(e=>{if(r.authStore.isLoading===!1){e();return}const a=x(()=>r.authStore.isLoading,i=>{i===!1&&(a(),e())},{immediate:!0})});return(e,a)=>{const i=F;return q(),J("div",Q,[V(i,{vertical:""},{default:W(()=>[b(D(B(o).currentTaskText||"Loading..."),1)]),_:1})])}}}),ke=K(X,[["__scopeId","data-v-01918b54"]]);export{ke as default};
