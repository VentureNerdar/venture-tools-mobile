import{a4 as y,au as D,a6 as k,bc as ee,ab as R,T as oe,z as g,bd as te,ah as _,r as S,v as N,a7 as K,ac as $,b as r,aQ as j,aR as H,m as M,aC as ne,az as F,aS as G,aT as U,as as z,n as ae,K as se,aa as le,N as re,be as ce,ay as T,ae as ie,aL as ue}from"./D0oBYrK6.js";import{u as de}from"./B9PI73v2.js";import{u as fe}from"./DrLKGOK6.js";import{P as ve}from"./B0nz0gyq.js";import{u as B}from"./CG-uOock.js";import{I as me}from"./DRpEo6ov.js";import{w as ye}from"./L-qg59-_.js";import{c as he}from"./DxSO8VGc.js";import{H as Ie}from"./DRbOzoBI.js";const Y={show:Boolean,zIndex:k,overlay:y,duration:k,teleport:[String,Object],lockScroll:y,lazyRender:y,beforeClose:Function,overlayStyle:Object,overlayClass:D,transitionAppear:Boolean,closeOnClickOverlay:y},Re=Object.keys(Y);let I=0;const E="van-overflow-hidden";function Oe(e,o){const n=fe(),c="01",s="10",l=u=>{n.move(u);const m=n.deltaY.value>0?s:c,P=te(u.target,e.value),{scrollHeight:h,offsetHeight:C,scrollTop:b}=P;let d="11";b===0?d=C>=h?"00":"01":b+C>=h&&(d="10"),d!=="11"&&n.isVertical()&&!(parseInt(d,2)&parseInt(m,2))&&_(u,!0)},i=()=>{document.addEventListener("touchstart",n.start),document.addEventListener("touchmove",l,{passive:!1}),I||document.body.classList.add(E),I++},a=()=>{I&&(document.removeEventListener("touchstart",n.start),document.removeEventListener("touchmove",l),I--,I||document.body.classList.remove(E))},v=()=>o()&&i(),O=()=>o()&&a();ee(v),R(O),oe(O),g(o,u=>{u?i():a()})}function V(e){const o=S(!1);return g(e,n=>{n&&(o.value=n)},{immediate:!0}),n=>()=>o.value?n():null}const[Ce,be]=K("overlay"),we={show:Boolean,zIndex:k,duration:k,className:D,lockScroll:y,lazyRender:y,customStyle:Object,teleport:[String,Object]};var ke=N({name:Ce,inheritAttrs:!1,props:we,setup(e,{attrs:o,slots:n}){const c=S(),s=V(()=>e.show||!e.lazyRender),l=a=>{e.lockScroll&&_(a,!0)},i=s(()=>{var a;const v=M(ne(e.zIndex),e.customStyle);return F(e.duration)&&(v.animationDuration=`${e.duration}s`),G(r("div",z({ref:c,style:v,class:[be(),e.className]},o),[(a=n.default)==null?void 0:a.call(n)]),[[U,e.show]])});return $("touchmove",l,{target:c}),()=>{const a=r(j,{name:"van-fade",appear:!0},{default:i});return e.teleport?r(H,{to:e.teleport},{default:()=>[a]}):a}}});const Se=ye(ke),Pe=M({},Y,{round:Boolean,position:T("center"),closeIcon:T("cross"),closeable:Boolean,transition:String,iconPrefix:String,closeOnPopstate:Boolean,closeIconPosition:T("top-right"),destroyOnClose:Boolean,safeAreaInsetTop:Boolean,safeAreaInsetBottom:Boolean}),[xe,L]=K("popup");var _e=N({name:xe,inheritAttrs:!1,props:Pe,emits:["open","close","opened","closed","keydown","update:show","clickOverlay","clickCloseIcon"],setup(e,{emit:o,attrs:n,slots:c}){let s,l;const i=S(),a=S(),v=V(()=>e.show||!e.lazyRender),O=ae(()=>{const t={zIndex:i.value};if(F(e.duration)){const f=e.position==="center"?"animationDuration":"transitionDuration";t[f]=`${e.duration}s`}return t}),u=()=>{s||(s=!0,i.value=e.zIndex!==void 0?+e.zIndex:ce(),o("open"))},m=()=>{s&&he(e.beforeClose,{done(){s=!1,o("close"),o("update:show",!1)}})},P=t=>{o("clickOverlay",t),e.closeOnClickOverlay&&m()},h=()=>{if(e.overlay)return r(Se,z({show:e.show,class:e.overlayClass,zIndex:i.value,duration:e.duration,customStyle:e.overlayStyle,role:e.closeOnClickOverlay?"button":void 0,tabindex:e.closeOnClickOverlay?0:void 0},B(),{onClick:P}),{default:c["overlay-content"]})},C=t=>{o("clickCloseIcon",t),m()},b=()=>{if(e.closeable)return r(me,{role:"button",tabindex:0,name:e.closeIcon,class:[L("close-icon",e.closeIconPosition),Ie],classPrefix:e.iconPrefix,onClick:C},null)};let d;const Z=()=>{d&&clearTimeout(d),d=setTimeout(()=>{o("opened")})},Q=()=>o("closed"),W=t=>o("keydown",t),q=v(()=>{var t;const{destroyOnClose:f,round:x,position:w,safeAreaInsetTop:J,safeAreaInsetBottom:X,show:A}=e;if(!(!A&&f))return G(r("div",z({ref:a,style:O.value,role:"dialog",tabindex:0,class:[L({round:x,[w]:w}),{"van-safe-area-top":J,"van-safe-area-bottom":X}],onKeydown:W},n,B()),[(t=c.default)==null?void 0:t.call(c),b()]),[[U,A]])}),p=()=>{const{position:t,transition:f,transitionAppear:x}=e,w=t==="center"?"van-fade":`van-popup-slide-${t}`;return r(j,{name:f||w,appear:x,onAfterEnter:Z,onAfterLeave:Q},{default:q})};return g(()=>e.show,t=>{t&&!s&&(u(),n.tabindex===0&&ie(()=>{var f;(f=a.value)==null||f.focus()})),!t&&s&&(s=!1,o("close"))}),de({popupRef:a}),Oe(a,()=>e.show&&e.lockScroll),$("popstate",()=>{e.closeOnPopstate&&(m(),l=!1)}),se(()=>{e.show&&u()}),le(()=>{l&&(o("update:show",!0),l=!1)}),R(()=>{e.show&&e.teleport&&(m(),l=!0)}),ue(ve,()=>e.show),()=>e.teleport?r(H,{to:e.teleport},{default:()=>[h(),p()]}):r(re,null,[h(),p()])}});export{Re as a,Y as p,_e as s,V as u};
