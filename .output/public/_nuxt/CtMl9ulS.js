import{s as W}from"./MFzdxIhx.js";import{v as I,a6 as U,au as M,ay as V,bf as X,a7 as D,z as L,K as F,b6 as Y,b as n,as as q,aW as Z,az as ee,m as z,ar as ae,aH as te,r as P,l as oe,a4 as le,aQ as ne,j as se,n as O,c as re,w as y,P as a,o as ie,d as B,t as T,an as R}from"./D0oBYrK6.js";import{I as K}from"./DRpEo6ov.js";import{H as ue}from"./DRbOzoBI.js";import{s as ce}from"./Civ38zqv.js";import{s as de}from"./Clbf9v06.js";import{s as me}from"./Ck0lcqSK.js";import{s as fe}from"./CMuqMoxK.js";import{s as ge}from"./Dyd55qle.js";import"./DYKtt-G7.js";/* empty css        *//* empty css        */import{P as pe,m as ve,u as ye,s as H}from"./Cfh9ZcJ-.js";import{u as j}from"./Cqgsff1D.js";import{u as he}from"./P3IRCB7t.js";import{u as ke}from"./rWoBeT6u.js";import{u as _e,R as be}from"./DLXjHHUB.js";import{u as Ce}from"./CDmbKUG5.js";import{u as Se}from"./M-rQ92U6.js";import{L as we}from"./DYp7AU8s.js";import{w as Pe}from"./L-qg59-_.js";import"./BChllD3H.js";import"./B9PI73v2.js";import"./BvcrrbVD.js";import"./DrLKGOK6.js";import"./B0nz0gyq.js";import"./CG-uOock.js";import"./DxSO8VGc.js";import"./DLyjkqNI.js";import"./DXum9Cw4.js";let w=0;function Ve(e){e?(w||document.body.classList.add("van-toast--unclickable"),w++):w&&(w--,w||document.body.classList.remove("van-toast--unclickable"))}const[xe,k]=D("toast"),Ue=["show","overlay","teleport","transition","overlayClass","overlayStyle","closeOnClickOverlay","zIndex"],Oe={icon:String,show:Boolean,type:V("text"),overlay:Boolean,message:U,iconSize:U,duration:X(2e3),position:V("middle"),teleport:[String,Object],wordBreak:String,className:M,iconPrefix:String,transition:V("van-fade"),loadingType:String,forbidClick:Boolean,overlayClass:M,overlayStyle:Object,closeOnClick:Boolean,closeOnClickOverlay:Boolean,zIndex:U};var G=I({name:xe,props:Oe,emits:["update:show"],setup(e,{emit:t,slots:g}){let d,m=!1;const p=()=>{const i=e.show&&e.forbidClick;m!==i&&(m=i,Ve(m))},r=i=>t("update:show",i),f=()=>{e.closeOnClick&&r(!1)},l=()=>clearTimeout(d),b=()=>{const{icon:i,type:u,iconSize:s,iconPrefix:o,loadingType:v}=e;if(i||u==="success"||u==="fail")return n(K,{name:i||u,size:s,class:k("icon"),classPrefix:o},null);if(u==="loading")return n(we,{class:k("loading"),size:s,type:v},null)},C=()=>{const{type:i,message:u}=e;if(g.message)return n("div",{class:k("text")},[g.message()]);if(ee(u)&&u!=="")return i==="html"?n("div",{key:0,class:k("text"),innerHTML:String(u)},null):n("div",{class:k("text")},[u])};return L(()=>[e.show,e.forbidClick],p),L(()=>[e.show,e.type,e.message,e.duration],()=>{l(),e.show&&e.duration>0&&(d=setTimeout(()=>{r(!1)},e.duration))}),F(p),Y(p),()=>n(pe,q({class:[k([e.position,e.wordBreak==="normal"?"break-normal":e.wordBreak,{[e.type]:!e.icon}]),e.className],lockScroll:!1,onClick:f,onClosed:l,"onUpdate:show":r},Z(e,Ue)),{default:()=>[b(),C()]})}});const Be={icon:"",type:"text",message:"",className:"",overlay:!1,onClose:void 0,onOpened:void 0,duration:2e3,teleport:"body",iconSize:void 0,iconPrefix:void 0,position:"middle",transition:"van-fade",forbidClick:!1,loadingType:void 0,overlayClass:"",overlayStyle:void 0,closeOnClick:!1,closeOnClickOverlay:!1};let _=[],Te=!1,A=z({},Be);const Le=new Map;function J(e){return te(e)?e:{message:e}}function Ie(){const{instance:e}=ve({setup(){const t=P(""),{open:g,state:d,close:m,toggle:p}=ye(),r=()=>{},f=()=>n(G,q(d,{onClosed:r,"onUpdate:show":p}),null);return L(t,l=>{d.message=l}),oe().render=f,{open:g,close:m,message:t}}});return e}function ze(){if(!_.length||Te){const e=Ie();_.push(e)}return _[_.length-1]}function Ne(e={}){if(!ae)return{};const t=ze(),g=J(e);return t.open(z({},A,Le.get(g.type||A.type),g)),t}const $e=e=>t=>Ne(z({type:e},J(t))),Me=$e("loading"),Re=e=>{_.length&&_[0].close()};Pe(G);const[He,E]=D("tag"),je={size:String,mark:Boolean,show:le,type:V("default"),color:String,plain:Boolean,round:Boolean,textColor:String,closeable:Boolean};var Ae=I({name:He,props:je,emits:["close"],setup(e,{slots:t,emit:g}){const d=r=>{r.stopPropagation(),g("close",r)},m=()=>e.plain?{color:e.textColor||e.color,borderColor:e.color}:{color:e.textColor,background:e.color},p=()=>{var r;const{type:f,mark:l,plain:b,round:C,size:i,closeable:u}=e,s={mark:l,plain:b,round:C};i&&(s[i]=i);const o=u&&n(K,{name:"cross",class:[E("close"),ue],onClick:d},null);return n("span",{style:m(),class:E([s,f])},[(r=t.default)==null?void 0:r.call(t),o])};return()=>n(ne,{name:e.closeable?"van-fade":void 0},{default:()=>[e.show?p():null]})}});const ha=I({__name:"profile",setup(e){const t=Se(),g=se(),d=j(),m=P(!1),p=P([]),r=P(""),f={roles:O(()=>ke().userRoles),auth:j(),languageStore:he(),settingStore:Ce()},l=P({id:null,name:"",username:"",email:"",phone_number:"",biography:"",preferred_language_id:"",user_role_id:null,contact_id:null}),b=()=>{l.value.contact_id&&g.push({path:"/createForm",query:{moduleName:"Contacts",id:l.value.contact_id}})},C=O(()=>f.languageStore.languages.map(s=>({text:s.name,value:s.id})));F(async()=>{if(d.authUser&&(l.value={...d.authUser},l.value.preferred_language_id)){const s=f.languageStore.languages.find(o=>o.id===l.value.preferred_language_id);s&&(p.value=[s.id],r.value=s.name,f.languageStore.setUserPreferredLanguage(s))}});const i=O(()=>{var s;return(s=f.roles.value.find(o=>o.id===l.value.user_role_id))==null?void 0:s.label}),u={handle:{click:{logout:async()=>{Me({message:"Logging out...",forbidClick:!1,duration:0,overlay:!1,position:"middle",loadingType:"spinner"});try{await d.logout(),await f.settingStore.toggleBiometric(!1),await f.settingStore.removePinNumber(),g.replace("/"),H({type:"success",message:"See you again!",duration:3e3})}catch{H({type:"danger",message:"Logout failed. Please try again",duration:2e3})}finally{Re()}},confirmLanguage:({selectedOptions:s})=>{m.value=!1;const o=s[0];l.value.preferred_language_id=o.value,r.value=o.text,p.value=[o.value]},update:async()=>{var h;await(await _e(be.USERS,(h=d.authUser)==null?void 0:h.id)).save(l.value);const v={...d.authUser,...l.value};d.authUser=v,localStorage.setItem("authUser",JSON.stringify(v));const S=f.languageStore.languages.find(x=>x.id===l.value.preferred_language_id);S&&f.languageStore.setUserPreferredLanguage(S)}}}};return(s,o)=>{const v=W,S=Ae,h=ce,x=de,Q=me,N=fe,$=ge;return ie(),re("div",null,[n($,null,{default:y(()=>[n(v,{modelValue:a(l).name,"onUpdate:modelValue":o[0]||(o[0]=c=>a(l).name=c),label:a(t).translate("name"),placeholder:a(t).translate("name")},null,8,["modelValue","label","placeholder"]),n(h,{title:a(t).translate("user_role")},{value:y(()=>[n(S,{type:"primary"},{default:y(()=>[B(T(a(i)),1)]),_:1})]),_:1},8,["title"]),n(v,{modelValue:a(l).username,"onUpdate:modelValue":o[1]||(o[1]=c=>a(l).username=c),label:a(t).translate("username"),placeholder:a(t).translate("username"),readonly:""},null,8,["modelValue","label","placeholder"]),n(v,{modelValue:a(l).email,"onUpdate:modelValue":o[2]||(o[2]=c=>a(l).email=c),label:a(t).translate("email"),placeholder:a(t).translate("email")},null,8,["modelValue","label","placeholder"]),n(v,{modelValue:a(l).phone_number,"onUpdate:modelValue":o[3]||(o[3]=c=>a(l).phone_number=c),label:a(t).translate("phone"),placeholder:a(t).translate("phone")},null,8,["modelValue","label","placeholder"]),n(v,{modelValue:a(l).biography,"onUpdate:modelValue":o[4]||(o[4]=c=>a(l).biography=c),label:a(t).translate("biography"),placeholder:a(t).translate("biography")},null,8,["modelValue","label","placeholder"]),n(h,{title:a(t).translate("contact_profile"),"is-link":!!a(l).contact_id,value:a(l).contact_id?a(t).translate("go_to_contact_profile"):a(t).translate("no_contact_profile"),onClick:b},null,8,["title","is-link","value"]),n(v,{modelValue:a(r),"onUpdate:modelValue":o[5]||(o[5]=c=>R(r)?r.value=c:null),label:a(t).translate("language"),placeholder:a(t).translate("language"),"is-link":"",readonly:"",onClick:o[6]||(o[6]=c=>m.value=!0)},null,8,["modelValue","label","placeholder"]),n(Q,{show:a(m),"onUpdate:show":o[8]||(o[8]=c=>R(m)?m.value=c:null),position:"bottom",round:""},{default:y(()=>[n(x,{"model-value":a(p),title:"Languages",columns:a(C),onCancel:o[7]||(o[7]=c=>m.value=!1),onConfirm:u.handle.click.confirmLanguage},null,8,["model-value","columns","onConfirm"])]),_:1},8,["show"]),n(h,null,{default:y(()=>[n(N,{type:"primary",block:"",size:"small",onClick:u.handle.click.update},{default:y(()=>[B(T(a(t).translate("update")),1)]),_:1},8,["onClick"])]),_:1})]),_:1}),n($,{title:a(t).translate("authentication")},{default:y(()=>[n(h,{"is-link":"",title:a(t).translate("change_password")},null,8,["title"]),n(h,{title:a(t).translate("log_out")},{value:y(()=>[n(N,{type:"danger",size:"mini",plain:"",block:"",onClick:u.handle.click.logout},{default:y(()=>[B(T(a(t).translate("log_out")),1)]),_:1},8,["onClick"])]),_:1},8,["title"])]),_:1},8,["title"])])}}});export{ha as default};
