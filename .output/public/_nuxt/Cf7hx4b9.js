import{s as N}from"./CsfyPUlP.js";import{g as v,r as y,x as G,j as A,N as w,L as E,v as F,A as R,c as I,b as U,w as x,o as J,d as V,t as W,Q as q}from"./WCNest2B.js";import{R as u,u as D}from"./Cr2qU9jd.js";import{u as g}from"./Cm4mLiGk.js";import{u as S}from"./CUePof4q.js";import{u as k,a as C}from"./CLEMSYjz.js";import{u as O}from"./CXkiMAsg.js";import{S as m}from"./DYQiILsP.js";import{u as b}from"./B7xup5iG.js";import{u as B}from"./uMCc_I0n.js";import{_ as H}from"./DlAUqK2U.js";import"./Djwo1Xbq.js";import"./WiwKGcPn.js";import"./BsX02fXv.js";import"./CRBec-Su.js";import"./19iBdKBD.js";import"./DRbOzoBI.js";import"./DCRuKwRe.js";import"./DW2nyF7B.js";import"./B0wI2Kio.js";import"./u7dc64rg.js";const j=v("communities",()=>{const c=y({}),n=y({});return{communities:c,communityChecklists:n,loadFromSecureStorage:async()=>{try{const t=await m.get({key:"communities"});c.value=JSON.parse(t.value)}catch(t){console.log(t),c.value={}}try{const t=await m.get({key:"communityChecklists"});n.value=JSON.parse(t.value)}catch(t){console.log(t),n.value={}}},setCommunities:async t=>{c.value=t,await m.set({key:"communities",value:JSON.stringify(t)})},setCommunityChecklists:async t=>{n.value=t,await m.set({key:"communityChecklists",value:JSON.stringify(t)})}}}),z={class:"wrap"},K=G({__name:"splash",setup(c){const n=A(),l=async(e,r)=>{try{const{value:i}=await m.get({key:e});return JSON.parse(i)}catch{return r}},d=e=>new Promise(r=>setTimeout(r,e)),s=w({completedModules:[],currentTaskText:"",defaultStoreOptions:{isPersist:!0},stores:{languages:g(),settings:S()},logoLoaded:!1,isLoading:!0}),t={all:!0},L=[["User Roles",u.USERS_ROLES,"userRoles",{...s.defaultStoreOptions,key:"userRoles",storeState:b().userRoles},{...t,whereNotIn:{key:"id",value:[1,2]}}],["Languages",u.LANGUAGES,"languages",{...s.defaultStoreOptions,key:"languages",storeState:g().languages},{...t,with:JSON.stringify(["translations"])}],["Language Words",u.LANGUAGE_WORDS,"languageWords",{...s.defaultStoreOptions,key:"languageWords",storeState:g().words},t],["Statuses",u.SETTINGS_STATUSES,"statuses",{...s.defaultStoreOptions,key:"statuses",storeState:S().statuses},t],["People Groups",u.PEOPLE_GROUPS,"peopleGroups",{...s.defaultStoreOptions,key:"peopleGroups",storeState:k().peopleGroups},t],["Communication Platforms",u.COMMUNICATION_PLATFORMS,"communicationPlatforms",{...s.defaultStoreOptions,key:"communicationPlatforms",storeState:O().communicationPlatforms},t],["Community Checklists",u.COMMUNITY_CHECKLISTS,"communityChecklists",{...s.defaultStoreOptions,key:"communityChecklists",storeState:j().communityChecklists},t],["Faith Milestones",u.FAITH_MILESTONES,"faithMilestones",{...s.defaultStoreOptions,key:"faithMilestones",storeState:C().faithMilestones},t]],a=w({faithMilestoneStore:C(),settings:S(),peopleGroupStore:k(),languageStore:g(),communicationPlatformStore:O(),authStore:B()});E(async()=>{console.log("[Splash] Starting initial load...");try{await a.authStore.loadFromSecureStorage(),await a.settings.loadFromSecureStorage(),await M(),console.log("[Splash] Auth loading finished ✅");const e=a.authStore.authUser,r=a.settings.pinCode;if(!e){console.log("[Splash] No user found → redirecting to /welcome"),n.replace("/welcome");return}console.log("[Splash] Authenticated user:",e.email),await _(),e&&r?n.replace("/pin"):(console.log("[Splash] Finished preload → go to /landing"),n.replace("/landing"))}catch(e){console.error("[Splash] Initialization error:",e),n.replace("/welcome")}});const _=async()=>{for(const[e,r,i,p,f]of L){if(s.currentTaskText=`Fetching ${e}...`,await P(e,r,f,{...s.defaultStoreOptions,key:i,store:p}),e==="Languages")try{const o=await l("languages",[]);let h;o&&o.length&&(h=o.find(T=>T.locale==="en"),a.languageStore.setUserPreferredLanguage(h))}catch(o){console.error("Error reading languages from secure storage",o)}if(e==="Statuses"){const o=await l("statuses",[]);a.settings.setStatuses(o)}if(e==="Faith Milestones"){const o=await l("faithMilestones",[]);a.faithMilestoneStore.setFaithMilestones(o)}if(e==="People Groups"){const o=await l("peopleGroups",[]);a.peopleGroupStore.setPeopleGroups(o)}if(e==="Languages"){const o=JSON.parse(localStorage.getItem("languages")||"[]");a.languageStore.setLanguages(o)}if(e==="Language Words"){const o=JSON.parse(localStorage.getItem("languageWords")||"[]");a.languageStore.setWords(o)}if(e==="Communication Platforms"){const o=await l("communicationPlatforms",[]);a.communicationPlatformStore.setCommunicationPlatforms(o)}await d(200),s.logoLoaded||(s.logoLoaded=!0)}F("/landing")},P=async(e,r,i,p)=>{await(await D(r)).browse(i,p),s.completedModules.push(e),e==="Faith Milestones"&&(s.currentTaskText="Redirecting . . . ")},M=async()=>new Promise(e=>{if(a.authStore.isLoading===!1){e();return}const r=R(()=>a.authStore.isLoading,i=>{i===!1&&(r(),e())},{immediate:!0})});return(e,r)=>{const i=N;return J(),I("div",z,[U(i,{vertical:""},{default:x(()=>[V(W(q(s).currentTaskText||"Loading..."),1)]),_:1})])}}}),fe=H(K,[["__scopeId","data-v-02a1ec9c"]]);export{fe as default};
