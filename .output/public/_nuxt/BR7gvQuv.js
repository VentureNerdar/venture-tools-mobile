import{s as F}from"./DI8BsxMS.js";import{A as I,g as T,z as E,y as H,b as o,aU as D,H as j,m as V,p as U,j as q,c as G,w as d,s as e,o as J,d as w,t as P,az as N}from"./BmfRkiaV.js";import{I as K}from"./CzVCmWdv.js";import{H as M}from"./DfeQPru4.js";import{s as O}from"./DmP2DozW.js";import{s as Q}from"./BC0_log-.js";import{a as W,s as X}from"./BxEIenso.js";import{s as Y}from"./BUefEaMs.js";import{s as Z}from"./BOjd9Maf.js";import"./Cg1rELBm.js";/* empty css        *//* empty css        */import{u as x}from"./sl6iD5LP.js";import{u as R}from"./mRv8m-Pp.js";import{u as ee}from"./aSEVn759.js";import{u as ae,R as le}from"./ChOzz0xL.js";import{u as B}from"./BpNJIUba.js";import{u as te}from"./DC1S3cbv.js";import"./CJXfhtl3.js";import"./B2j5j-1v.js";import"./CUh0w1uZ.js";import"./CjIwhJnV.js";import"./C46FpIvt.js";import"./fHOo4ywH.js";import"./Djadx4BN.js";import"./SA1PHHHp.js";import"./ZSLprN7U.js";import"./MceW-OHr.js";const[oe,z]=I("tag"),ne={size:String,mark:Boolean,show:H,type:E("default"),color:String,plain:Boolean,round:Boolean,textColor:String,closeable:Boolean};var re=T({name:oe,props:ne,emits:["close"],setup(s,{slots:h,emit:t}){const k=u=>{u.stopPropagation(),t("close",u)},m=()=>s.plain?{color:s.textColor||s.color,borderColor:s.color}:{color:s.textColor,background:s.color},c=()=>{var u;const{type:g,mark:_,plain:l,round:C,size:v,closeable:y}=s,f={mark:_,plain:l,round:C};v&&(f[v]=v);const n=y&&o(K,{name:"cross",class:[z("close"),M],onClick:k},null);return o("span",{style:m(),class:z([f,g])},[(u=h.default)==null?void 0:u.call(h),n])};return()=>o(D,{name:s.closeable?"van-fade":void 0},{default:()=>[s.show?c():null]})}});const Te=T({__name:"profile",setup(s){const h=B(),t=te(),k=j(),m=x(),c=V(!1),u=V([]),g=V(""),_={roles:U(()=>ee().userRoles),auth:x(),languages:R().languages},l=V({id:null,name:"",username:"",email:"",phone_number:"",biography:"",preferred_language_id:"",user_role_id:null,contact_id:null}),C=()=>{l.value.contact_id&&k.push({path:"/createForm",query:{moduleName:"Contacts",id:l.value.contact_id}})},v=U(()=>R().languages.map(n=>({text:n.name,value:n.id})));q(async()=>{if(await h.loadFromSecureStorage(),await m.loadFromSecureStorage(),m.authUser&&(l.value={...m.authUser},l.value.preferred_language_id)){const n=_.languages.find(a=>a.id===l.value.preferred_language_id);n&&(u.value=[n.id],g.value=n.name,B().setUserPreferredLanguage(n))}});const y=U(()=>{var n;return(n=_.roles.value.find(a=>a.id===l.value.user_role_id))==null?void 0:n.label}),f={handle:{click:{logout:async()=>{await x().logout(),X({type:"success",message:"See you again!",duration:2e3})},confirmLanguage:({selectedOptions:n})=>{c.value=!1;const a=n[0];l.value.preferred_language_id=a.value,g.value=a.text,u.value=[a.value]},update:async()=>{var p;await(await ae(le.USERS,(p=m.authUser)==null?void 0:p.id)).save(l.value);const i={...m.authUser,...l.value};m.authUser=i,localStorage.setItem("authUser",JSON.stringify(i));const b=_.languages.find(S=>S.id===l.value.preferred_language_id);b&&B().setUserPreferredLanguage(b)}}}};return(n,a)=>{const i=F,b=re,p=O,S=Q,A=W,L=Y,$=Z;return J(),G("div",null,[o($,null,{default:d(()=>[o(i,{modelValue:e(l).name,"onUpdate:modelValue":a[0]||(a[0]=r=>e(l).name=r),label:e(t).translate("name"),placeholder:e(t).translate("name")},null,8,["modelValue","label","placeholder"]),o(p,{title:e(t).translate("user_role")},{value:d(()=>[o(b,{type:"primary"},{default:d(()=>[w(P(e(y)),1)]),_:1})]),_:1},8,["title"]),o(i,{modelValue:e(l).username,"onUpdate:modelValue":a[1]||(a[1]=r=>e(l).username=r),label:e(t).translate("username"),placeholder:e(t).translate("username"),readonly:""},null,8,["modelValue","label","placeholder"]),o(i,{modelValue:e(l).email,"onUpdate:modelValue":a[2]||(a[2]=r=>e(l).email=r),label:e(t).translate("email"),placeholder:e(t).translate("email")},null,8,["modelValue","label","placeholder"]),o(i,{modelValue:e(l).phone_number,"onUpdate:modelValue":a[3]||(a[3]=r=>e(l).phone_number=r),label:e(t).translate("phone"),placeholder:e(t).translate("phone")},null,8,["modelValue","label","placeholder"]),o(i,{modelValue:e(l).biography,"onUpdate:modelValue":a[4]||(a[4]=r=>e(l).biography=r),label:e(t).translate("biography"),placeholder:e(t).translate("biography")},null,8,["modelValue","label","placeholder"]),o(p,{title:e(t).translate("contact_profile"),"is-link":!!e(l).contact_id,value:e(l).contact_id?e(t).translate("go_to_contact_profile"):e(t).translate("no_contact_profile"),onClick:C},null,8,["title","is-link","value"]),o(i,{modelValue:e(g),"onUpdate:modelValue":a[5]||(a[5]=r=>N(g)?g.value=r:null),label:e(t).translate("language"),placeholder:e(t).translate("language"),"is-link":"",readonly:"",onClick:a[6]||(a[6]=r=>c.value=!0)},null,8,["modelValue","label","placeholder"]),o(A,{show:e(c),"onUpdate:show":a[8]||(a[8]=r=>N(c)?c.value=r:null),position:"bottom",round:""},{default:d(()=>[o(S,{"model-value":e(u),title:"Languages",columns:e(v),onCancel:a[7]||(a[7]=r=>c.value=!1),onConfirm:f.handle.click.confirmLanguage},null,8,["model-value","columns","onConfirm"])]),_:1},8,["show"]),o(p,null,{default:d(()=>[o(L,{type:"primary",block:"",size:"small",onClick:f.handle.click.update},{default:d(()=>[w(P(e(t).translate("update")),1)]),_:1},8,["onClick"])]),_:1})]),_:1}),o($,{title:e(t).translate("authentication")},{default:d(()=>[o(p,{"is-link":"",title:e(t).translate("change_password")},null,8,["title"]),o(p,{title:e(t).translate("log_out")},{value:d(()=>[o(L,{type:"danger",size:"mini",plain:"",block:"",onClick:f.handle.click.logout},{default:d(()=>[w(P(e(t).translate("log_out")),1)]),_:1},8,["onClick"])]),_:1},8,["title"])]),_:1},8,["title"])])}}});export{Te as default};
