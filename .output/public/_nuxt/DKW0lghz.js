import{s as F}from"./DLRAkl61.js";import{s as I}from"./BqV7Ghxx.js";import{s as x}from"./sm_BGTV-.js";import{s as U,a as E}from"./B-R195wI.js";import{g as $,H as B,r as T,j as S,p as G,l as v,c as K,o as m,az as _,s as o,F as V,b as r,q as C,w as t,d as f,t as H,m as M}from"./BcM8nbUc.js";import"./BZvMXGx7.js";import"./C1587OLP.js";import{s as k}from"./CbYSZLda.js";import{u as j}from"./ZXv_2jnj.js";import{u as q}from"./DbRHh0Ao.js";import"./wzS7IZBv.js";import"./DQZbwPUK.js";import"./1cSE0txk.js";import"./DfeQPru4.js";import"./B4-co7sM.js";import"./D4r7wC-U.js";import"./B7B4zphO.js";import"./CQbdaxH3.js";import"./DGqFMbKC.js";import"./C2uxVfP1.js";import"./BIZiQy_b.js";const z=$({__name:"newPin",emits:["newPinChanged"],setup(R,{emit:p}){const P=p,h=q(),i=B(),e=T({form:{pin:"",confirmPin:"",currentPin:""},errorInfo:"",showPinForm:!1,show:{pinKeyboard:!1,confirmPinKeyboard:!1,currentPinKeyboard:!1,removePinKeyboard:!1},isChangingPin:!1,hasPin:!1}),l=j();S(async()=>{await l.loadFromSecureStorage(),e.hasPin=l.pinNumber});const u={handle:{focus:{pin:()=>{e.show.pinKeyboard=!0,e.show.confirmPinKeyboard=!1,e.show.currentPinKeyboard=!1,e.show.removePinKeyboard=!1},confirmPin:()=>{e.show.confirmPinKeyboard=!0,e.show.pinKeyboard=!1,e.show.currentPinKeyboard=!1,e.show.removePinKeyboard=!1},currentPin:()=>{e.show.currentPinKeyboard=!0,e.show.pinKeyboard=!1,e.show.confirmPinKeyboard=!1,e.show.removePinKeyboard=!1},removePin:()=>{e.show.removePinKeyboard=!0,e.show.pinKeyboard=!1,e.show.confirmPinKeyboard=!1,e.show.currentPinKeyboard=!1}},showChangePinForm:()=>{e.showPinForm=!0,e.isChangingPin=!0},removePin:async()=>{e.show.removePinKeyboard=!1,e.form.currentPin===l.pinCode?(await l.removePinNumber(),k({type:"success",message:"PIN removed successfully",duration:2e3}),setTimeout(()=>{i.push("/settings/security")},300)):k({type:"danger",message:"Incorrect PIN",duration:2e3})}}},y=G(()=>{const s=e.form.pin.length===4&&e.form.confirmPin.length===4,n=e.form.pin===e.form.confirmPin;return e.isChangingPin?s&&n&&e.form.currentPin===l.pinCode:s&&n});v([()=>e.form.pin,()=>e.form.confirmPin],()=>{const s=e.form.pin.length===4&&e.form.confirmPin.length===4,n=e.form.pin===e.form.confirmPin;e.errorInfo=s&&!n?"PINs do not match":""}),v(()=>e.form.pin,s=>{s.length>4&&(e.form.pin=s.slice(0,4)),s.length===4&&P("newPinChanged",s)}),v(()=>e.form.confirmPin,s=>{s.length>4&&(e.form.confirmPin=s.slice(0,4))}),v(()=>e.form.currentPin,s=>{s.length>4&&(e.form.currentPin=s.slice(0,4))});const N=async()=>{y.value&&(await l.setPinNumber(e.form.pin),k({type:"success",message:e.isChangingPin?"PIN changed successfully":"PIN created successfully",duration:2e3}),setTimeout(()=>{i.push("/settings/security")},300))};return(s,n)=>{const g=F,d=I,c=x,b=U,w=E;return m(),K("div",null,[o(e).hasPin&&!o(e).showPinForm?(m(),K(V,{key:0},[r(c,null,{default:t(()=>[r(d,null,{default:t(()=>[r(g,{block:"",type:"primary",onClick:u.handle.showChangePinForm},{default:t(()=>n[7]||(n[7]=[f(" Change PIN Number ")])),_:1},8,["onClick"])]),_:1}),r(d,null,{default:t(()=>[r(g,{block:"",type:"danger",onClick:u.handle.focus.removePin},{default:t(()=>n[8]||(n[8]=[f(" Remove PIN Number ")])),_:1},8,["onClick"])]),_:1})]),_:1}),o(e).show.removePinKeyboard?(m(),C(c,{key:0},{default:t(()=>[r(d,{title:"Enter PIN to remove"},{default:t(()=>[r(b,{value:o(e).form.currentPin,focused:o(e).show.removePinKeyboard,length:"4",onFocus:u.handle.focus.removePin},null,8,["value","focused","onFocus"]),r(w,{modelValue:o(e).form.currentPin,"onUpdate:modelValue":n[0]||(n[0]=a=>o(e).form.currentPin=a),show:o(e).show.removePinKeyboard},null,8,["modelValue","show"])]),_:1}),r(d,null,{default:t(()=>[r(g,{block:"",type:"danger",onClick:u.handle.removePin},{default:t(()=>n[9]||(n[9]=[f(" Confirm Remove ")])),_:1},8,["onClick"])]),_:1})]),_:1})):_("",!0)],64)):_("",!0),!o(e).hasPin||o(e).showPinForm?(m(),K(V,{key:1},[o(e).isChangingPin?(m(),C(c,{key:0,title:"Enter current PIN",style:{"padding-top":"10px","padding-bottom":"10px"}},{default:t(()=>[r(b,{value:o(e).form.currentPin,focused:o(e).show.currentPinKeyboard,length:"4",onFocus:u.handle.focus.currentPin},null,8,["value","focused","onFocus"]),r(w,{modelValue:o(e).form.currentPin,"onUpdate:modelValue":n[1]||(n[1]=a=>o(e).form.currentPin=a),show:o(e).show.currentPinKeyboard,onBlur:n[2]||(n[2]=a=>o(e).show.currentPinKeyboard=!1)},null,8,["modelValue","show"])]),_:1})):_("",!0),r(c,{title:o(h).translate("enter_your_pin_number"),style:{"padding-top":"10px","padding-bottom":"10px"}},{default:t(()=>[r(b,{value:o(e).form.pin,focused:o(e).show.pinKeyboard,length:"4",onFocus:u.handle.focus.pin},null,8,["value","focused","onFocus"]),r(w,{modelValue:o(e).form.pin,"onUpdate:modelValue":n[3]||(n[3]=a=>o(e).form.pin=a),show:o(e).show.pinKeyboard,onBlur:n[4]||(n[4]=a=>o(e).show.pinKeyboard=!1)},null,8,["modelValue","show"])]),_:1},8,["title"]),r(c,{title:o(h).translate("confirm_your_pin_number"),style:{"padding-top":"10px","padding-bottom":"10px"}},{default:t(()=>[r(b,{value:o(e).form.confirmPin,focused:o(e).show.confirmPinKeyboard,"error-info":o(e).errorInfo,length:"4",onFocus:u.handle.focus.confirmPin},null,8,["value","focused","error-info","onFocus"]),r(w,{modelValue:o(e).form.confirmPin,"onUpdate:modelValue":n[5]||(n[5]=a=>o(e).form.confirmPin=a),show:o(e).show.confirmPinKeyboard,onBlur:n[6]||(n[6]=a=>o(e).show.confirmPinKeyboard=!1)},null,8,["modelValue","show"])]),_:1},8,["title"]),r(d,null,{default:t(()=>[r(g,{block:"",type:"success",disabled:!o(y),onClick:N},{default:t(()=>[f(H(o(h).translate("save")),1)]),_:1},8,["disabled"])]),_:1})],64)):_("",!0)])}}}),fe=$({__name:"pin",setup(R){const p=B(),P=M(!1);return S(()=>{P.value=!!localStorage.getItem("PINNumber")}),(h,i)=>{const e=F,l=I,u=x,y=z;return m(),K("div",null,[o(P)?(m(),C(u,{key:0},{default:t(()=>[r(l,null,{default:t(()=>[r(e,{block:"",type:"primary",onClick:i[0]||(i[0]=N=>o(p).push("/settings/security/edit-pin"))},{default:t(()=>i[2]||(i[2]=[f(" Change PIN Number ")])),_:1})]),_:1}),r(l,null,{default:t(()=>[r(e,{block:"",type:"danger",onClick:i[1]||(i[1]=N=>o(p).push("/settings/security/delete-pin"))},{default:t(()=>i[3]||(i[3]=[f(" Remove PIN Number ")])),_:1})]),_:1})]),_:1})):(m(),C(y,{key:1}))])}}});export{fe as default};
