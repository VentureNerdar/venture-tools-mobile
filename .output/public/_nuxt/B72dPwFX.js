import{s as F}from"./DYKtt-G7.js";import{g as E,r as y,v as R,j as A,M as w,K as I,s as U,z as x,c as J,b as V,w as W,o as q,d as b,t as D,P as z}from"./D0oBYrK6.js";import{R as u,u as B}from"./DLXjHHUB.js";import{u as g}from"./P3IRCB7t.js";import{u as S}from"./CDmbKUG5.js";import{u as C,a as k}from"./CeRD7M4w.js";import{u as O}from"./CHPijX-L.js";import{s as P,a as _,S as H}from"./DXum9Cw4.js";import{u as K}from"./rWoBeT6u.js";import{u as $}from"./Cqgsff1D.js";import{_ as j}from"./DlAUqK2U.js";import"./DRpEo6ov.js";import"./L-qg59-_.js";import"./Ck0lcqSK.js";import"./B9PI73v2.js";import"./DrLKGOK6.js";import"./DRbOzoBI.js";import"./B0nz0gyq.js";import"./CG-uOock.js";import"./DxSO8VGc.js";import"./Cfh9ZcJ-.js";import"./DLyjkqNI.js";const Y=E("communities",()=>{const c=y({}),i=y({});return{communities:c,communityChecklists:i,loadFromSecureStorage:async()=>{try{const t=await P("communities");t.value&&(c.value=JSON.parse(t.value))}catch(t){console.log(t),c.value={}}try{const t=await P("communityChecklists");t.value&&(i.value=JSON.parse(t.value))}catch(t){console.log(t),i.value={}}},setCommunities:async t=>{c.value=t,await _("communities",JSON.stringify(t))},setCommunityChecklists:async t=>{i.value=t,await _("communityChecklists",JSON.stringify(t))}}}),Q={class:"wrap"},X=R({__name:"splash",setup(c){const i=A(),l=async(e,a)=>{try{const{value:n}=await H.get({key:e});return JSON.parse(n)}catch{return a}},f=e=>new Promise(a=>setTimeout(a,e)),o=w({completedModules:[],currentTaskText:"",defaultStoreOptions:{isPersist:!0},stores:{languages:g(),settings:S()},logoLoaded:!1,isLoading:!0}),t={all:!0},L=[["Languages",u.LANGUAGES,"languages",{...o.defaultStoreOptions,key:"languages",storeState:g().languages},{...t,with:JSON.stringify(["translations"])}],["Language Words",u.LANGUAGE_WORDS,"languageWords",{...o.defaultStoreOptions,key:"languageWords",storeState:g().words},t]],T=[["User Roles",u.USERS_ROLES,"userRoles",{...o.defaultStoreOptions,key:"userRoles",storeState:K().userRoles},{...t,whereNotIn:{key:"id",value:[1,2]}}],["Statuses",u.SETTINGS_STATUSES,"statuses",{...o.defaultStoreOptions,key:"statuses",storeState:S().statuses},t],["People Groups",u.PEOPLE_GROUPS,"peopleGroups",{...o.defaultStoreOptions,key:"peopleGroups",storeState:C().peopleGroups},t],["Communication Platforms",u.COMMUNICATION_PLATFORMS,"communicationPlatforms",{...o.defaultStoreOptions,key:"communicationPlatforms",storeState:O().communicationPlatforms},t],["Community Checklists",u.COMMUNITY_CHECKLISTS,"communityChecklists",{...o.defaultStoreOptions,key:"communityChecklists",storeState:Y().communityChecklists},t],["Faith Milestones",u.FAITH_MILESTONES,"faithMilestones",{...o.defaultStoreOptions,key:"faithMilestones",storeState:k().faithMilestones},t]],r=w({faithMilestoneStore:k(),settings:S(),peopleGroupStore:C(),languageStore:g(),communicationPlatformStore:O(),authStore:$()});I(async()=>{try{await M(),await r.authStore.loadFromSecureStorage(),await r.settings.loadFromSecureStorage(),await G();const e=r.authStore.authUser,a=r.settings.pinCode;if(!e){console.log("[Splash] No user found → redirecting to /welcome"),i.replace("/welcome");return}console.log("[Splash] Authenticated user:",e.email),await N(),e&&a?i.replace("/pin"):(console.log("[Splash] Finished preload → go to /landing"),i.replace("/landing"))}catch(e){console.error("[Splash] Initialization error:",e),i.replace("/welcome")}});const M=async()=>{for(const[e,a,n,m,p]of L){if(o.currentTaskText=`Fetching ${e}...`,await d(e,a,p,{...o.defaultStoreOptions,key:n,store:m}),e==="Languages")try{const s=await l("languages",[]);let h;s&&s.length&&(h=s.find(v=>v.locale==="en"),r.languageStore.setUserPreferredLanguage(h))}catch(s){console.error("Error reading languages from secure storage",s)}if(e==="Languages"){const s=JSON.parse(localStorage.getItem("languages")||"[]");r.languageStore.setLanguages(s)}if(e==="Language Words"){const s=JSON.parse(localStorage.getItem("languageWords")||"[]");r.languageStore.setWords(s)}}},N=async()=>{for(const[e,a,n,m,p]of T){if(o.currentTaskText=`Fetching ${e}...`,await d(e,a,p,{...o.defaultStoreOptions,key:n,store:m}),e==="Statuses"){const s=await l("statuses",[]);r.settings.setStatuses(s)}if(e==="Faith Milestones"){const s=await l("faithMilestones",[]);r.faithMilestoneStore.setFaithMilestones(s)}if(e==="People Groups"){const s=await l("peopleGroups",[]);r.peopleGroupStore.setPeopleGroups(s)}if(e==="Communication Platforms"){const s=await l("communicationPlatforms",[]);r.communicationPlatformStore.setCommunicationPlatforms(s)}await f(200),o.logoLoaded||(o.logoLoaded=!0)}U("/landing")},d=async(e,a,n,m)=>{await(await B(a)).browse(n,m),o.completedModules.push(e),e==="Faith Milestones"&&(o.currentTaskText="Redirecting . . . ")},G=async()=>new Promise(e=>{if(r.authStore.isLoading===!1){e();return}const a=x(()=>r.authStore.isLoading,n=>{n===!1&&(a(),e())},{immediate:!0})});return(e,a)=>{const n=F;return q(),J("div",Q,[V(n,{vertical:""},{default:W(()=>[b(D(z(o).currentTaskText||"Loading..."),1)]),_:1})])}}}),ke=j(X,[["__scopeId","data-v-092fec46"]]);export{ke as default};
