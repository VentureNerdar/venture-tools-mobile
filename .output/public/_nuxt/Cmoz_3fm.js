import{s as T}from"./BxDJ6L9Z.js";import{a0 as I,q as N,ar as z,Y as A,b as o,ay as E,H,r as k,k as S,B as F,c as q,w as d,G as e,o as D,d as U,t as P,ag as B}from"./CgLqU3VH.js";import{I as G}from"./HxHLOl1u.js";import{H as J}from"./DRbOzoBI.js";import{s as K}from"./t2abA-eB.js";import{s as M}from"./Deq3FwQt.js";import{a as O,s as Y}from"./xOkdFqHb.js";import{s as j}from"./w3ID7QVF.js";import{s as Q}from"./BvycYH9f.js";import"./DVh_DFyP.js";/* empty css        *//* empty css        */import{u as L}from"./6oBJUghW.js";import{u as W}from"./BDi8VCzM.js";import{u as X}from"./UQTTTx7s.js";import{u as Z,R as ee}from"./CfTz9f_u.js";import{u as ae}from"./DxxVmql2.js";import"./C1lnAiq-.js";import"./EUr6UOpb.js";import"./CswrCj-5.js";import"./D_uAf_x7.js";import"./D8ZCcbxd.js";import"./qRfUb8lo.js";import"./lpiHUGp3.js";import"./De5honCs.js";import"./D_fUFj-z.js";import"./CwZMPUJj.js";const[le,$]=I("tag"),te={size:String,mark:Boolean,show:A,type:z("default"),color:String,plain:Boolean,round:Boolean,textColor:String,closeable:Boolean};var oe=N({name:le,props:te,emits:["close"],setup(u,{slots:l,emit:h}){const m=s=>{s.stopPropagation(),h("close",s)},c=()=>u.plain?{color:u.textColor||u.color,borderColor:u.color}:{color:u.textColor,background:u.color},f=()=>{var s;const{type:p,mark:t,plain:V,round:C,size:_,closeable:v}=u,n={mark:t,plain:V,round:C};_&&(n[_]=_);const a=v&&o(G,{name:"cross",class:[$("close"),J],onClick:m},null);return o("span",{style:c(),class:$([n,p])},[(s=l.default)==null?void 0:s.call(l),a])};return()=>o(E,{name:u.closeable?"van-fade":void 0},{default:()=>[u.show?f():null]})}});const Ne=N({__name:"profile",setup(u){const l=ae(),h=H(),m=L(),c=k(!1),f=k([]),s=k(""),p={roles:S(()=>X().userRoles),auth:L(),languageStore:W()},t=k({id:null,name:"",username:"",email:"",phone_number:"",biography:"",preferred_language_id:"",user_role_id:null,contact_id:null}),V=()=>{t.value.contact_id&&h.push({path:"/createForm",query:{moduleName:"Contacts",id:t.value.contact_id}})},C=S(()=>p.languageStore.languages.map(n=>({text:n.name,value:n.id})));F(async()=>{if(m.authUser&&(t.value={...m.authUser},t.value.preferred_language_id)){const n=p.languageStore.languages.find(a=>a.id===t.value.preferred_language_id);n&&(f.value=[n.id],s.value=n.name,p.languageStore.setUserPreferredLanguage(n))}});const _=S(()=>{var n;return(n=p.roles.value.find(a=>a.id===t.value.user_role_id))==null?void 0:n.label}),v={handle:{click:{logout:async()=>{await m.logout(),h.replace("/"),Y({type:"success",message:"See you again!",duration:2e3})},confirmLanguage:({selectedOptions:n})=>{c.value=!1;const a=n[0];t.value.preferred_language_id=a.value,s.value=a.text,f.value=[a.value]},update:async()=>{var g;await(await Z(ee.USERS,(g=m.authUser)==null?void 0:g.id)).save(t.value);const i={...m.authUser,...t.value};m.authUser=i,localStorage.setItem("authUser",JSON.stringify(i));const b=p.languageStore.languages.find(y=>y.id===t.value.preferred_language_id);b&&p.languageStore.setUserPreferredLanguage(b)}}}};return(n,a)=>{const i=T,b=oe,g=K,y=M,R=O,w=j,x=Q;return D(),q("div",null,[o(x,null,{default:d(()=>[o(i,{modelValue:e(t).name,"onUpdate:modelValue":a[0]||(a[0]=r=>e(t).name=r),label:e(l).translate("name"),placeholder:e(l).translate("name")},null,8,["modelValue","label","placeholder"]),o(g,{title:e(l).translate("user_role")},{value:d(()=>[o(b,{type:"primary"},{default:d(()=>[U(P(e(_)),1)]),_:1})]),_:1},8,["title"]),o(i,{modelValue:e(t).username,"onUpdate:modelValue":a[1]||(a[1]=r=>e(t).username=r),label:e(l).translate("username"),placeholder:e(l).translate("username"),readonly:""},null,8,["modelValue","label","placeholder"]),o(i,{modelValue:e(t).email,"onUpdate:modelValue":a[2]||(a[2]=r=>e(t).email=r),label:e(l).translate("email"),placeholder:e(l).translate("email")},null,8,["modelValue","label","placeholder"]),o(i,{modelValue:e(t).phone_number,"onUpdate:modelValue":a[3]||(a[3]=r=>e(t).phone_number=r),label:e(l).translate("phone"),placeholder:e(l).translate("phone")},null,8,["modelValue","label","placeholder"]),o(i,{modelValue:e(t).biography,"onUpdate:modelValue":a[4]||(a[4]=r=>e(t).biography=r),label:e(l).translate("biography"),placeholder:e(l).translate("biography")},null,8,["modelValue","label","placeholder"]),o(g,{title:e(l).translate("contact_profile"),"is-link":!!e(t).contact_id,value:e(t).contact_id?e(l).translate("go_to_contact_profile"):e(l).translate("no_contact_profile"),onClick:V},null,8,["title","is-link","value"]),o(i,{modelValue:e(s),"onUpdate:modelValue":a[5]||(a[5]=r=>B(s)?s.value=r:null),label:e(l).translate("language"),placeholder:e(l).translate("language"),"is-link":"",readonly:"",onClick:a[6]||(a[6]=r=>c.value=!0)},null,8,["modelValue","label","placeholder"]),o(R,{show:e(c),"onUpdate:show":a[8]||(a[8]=r=>B(c)?c.value=r:null),position:"bottom",round:""},{default:d(()=>[o(y,{"model-value":e(f),title:"Languages",columns:e(C),onCancel:a[7]||(a[7]=r=>c.value=!1),onConfirm:v.handle.click.confirmLanguage},null,8,["model-value","columns","onConfirm"])]),_:1},8,["show"]),o(g,null,{default:d(()=>[o(w,{type:"primary",block:"",size:"small",onClick:v.handle.click.update},{default:d(()=>[U(P(e(l).translate("update")),1)]),_:1},8,["onClick"])]),_:1})]),_:1}),o(x,{title:e(l).translate("authentication")},{default:d(()=>[o(g,{"is-link":"",title:e(l).translate("change_password")},null,8,["title"]),o(g,{title:e(l).translate("log_out")},{value:d(()=>[o(w,{type:"danger",size:"mini",plain:"",block:"",onClick:v.handle.click.logout},{default:d(()=>[U(P(e(l).translate("log_out")),1)]),_:1},8,["onClick"])]),_:1},8,["title"])]),_:1},8,["title"])])}}});export{Ne as default};
