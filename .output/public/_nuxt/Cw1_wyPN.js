import{s as V}from"./BK_JaSOI.js";import{s as I}from"./Bw11CPOK.js";import{s as x}from"./BEf9PdUx.js";import{s as E,a as T}from"./DvfJuSVm.js";import{p as $,J as S,H as G,F as B,l as H,v as w,c as _,o as u,ai as v,I as o,ak as F,b as r,y as K,w as t,d as f,t as M,r as A}from"./C5-unR8A.js";import"./DEIA4b5u.js";import"./DeMFXbmw.js";import{s as N}from"./NvExoH8Z.js";import{u as R}from"./eUU5mXgt.js";import{u as D}from"./CPjOJWZh.js";import"./DfGDoUoe.js";import"./DPl71k4s.js";import"./CqmJUeIp.js";import"./DRbOzoBI.js";import"./DQx6QDwE.js";import"./CRXCwq06.js";import"./BdLxnj8Y.js";import"./BXPZbmyz.js";import"./uRnIUuRV.js";import"./CM4--pTJ.js";const J=$({__name:"newPin",emits:["newPinChanged"],setup(U,{emit:p}){const P=p,m=D(),C=S(),e=G({form:{pin:"",confirmPin:"",currentPin:""},errorInfo:"",showPinForm:!1,show:{pinKeyboard:!1,confirmPinKeyboard:!1,currentPinKeyboard:!1,removePinKeyboard:!1},isChangingPin:!1,hasPin:!1}),l=R();B(async()=>{await l.loadFromSecureStorage(),e.hasPin=l.pinNumber});const i={handle:{focus:{pin:()=>{e.show.pinKeyboard=!0,e.show.confirmPinKeyboard=!1,e.show.currentPinKeyboard=!1,e.show.removePinKeyboard=!1},confirmPin:()=>{e.show.confirmPinKeyboard=!0,e.show.pinKeyboard=!1,e.show.currentPinKeyboard=!1,e.show.removePinKeyboard=!1},currentPin:()=>{e.show.currentPinKeyboard=!0,e.show.pinKeyboard=!1,e.show.confirmPinKeyboard=!1,e.show.removePinKeyboard=!1},removePin:()=>{e.show.removePinKeyboard=!0,e.show.pinKeyboard=!1,e.show.confirmPinKeyboard=!1,e.show.currentPinKeyboard=!1}},showChangePinForm:()=>{e.showPinForm=!0,e.isChangingPin=!0},removePin:async()=>{e.show.removePinKeyboard=!1,e.form.currentPin===l.pinCode?(await l.removePinNumber(),N({type:"success",message:"PIN removed successfully",duration:2e3}),setTimeout(()=>{C.push("/settings/security")},300)):N({type:"danger",message:"Incorrect PIN",duration:2e3})}}},h=H(()=>{const s=e.form.pin.length===4&&e.form.confirmPin.length===4,n=e.form.pin===e.form.confirmPin;return e.isChangingPin?s&&n&&e.form.currentPin===l.pinCode:s&&n});w([()=>e.form.pin,()=>e.form.confirmPin],()=>{const s=e.form.pin.length===4&&e.form.confirmPin.length===4,n=e.form.pin===e.form.confirmPin;e.errorInfo=s&&!n?"PINs do not match":""}),w(()=>e.form.pin,s=>{s.length>4&&(e.form.pin=s.slice(0,4)),s.length===4&&P("newPinChanged",s)}),w(()=>e.form.confirmPin,s=>{s.length>4&&(e.form.confirmPin=s.slice(0,4))}),w(()=>e.form.currentPin,s=>{s.length>4&&(e.form.currentPin=s.slice(0,4))});const k=async()=>{h.value&&(await l.setPinNumber(e.form.pin),N({type:"success",message:e.isChangingPin?"PIN changed successfully":"PIN created successfully",duration:2e3}),setTimeout(()=>{C.push("/settings/security")},300))};return(s,n)=>{const y=V,d=I,c=x,g=E,b=T;return u(),_("div",null,[o(e).hasPin&&!o(e).showPinForm?(u(),_(F,{key:0},[r(c,null,{default:t(()=>[r(d,null,{default:t(()=>[r(y,{block:"",type:"primary",onClick:i.handle.showChangePinForm},{default:t(()=>n[7]||(n[7]=[f(" Change PIN Number ")])),_:1},8,["onClick"])]),_:1}),r(d,null,{default:t(()=>[r(y,{block:"",type:"danger",onClick:i.handle.focus.removePin},{default:t(()=>n[8]||(n[8]=[f(" Remove PIN Number ")])),_:1},8,["onClick"])]),_:1})]),_:1}),o(e).show.removePinKeyboard?(u(),K(c,{key:0},{default:t(()=>[r(d,{title:"Enter PIN to remove"},{default:t(()=>[r(g,{value:o(e).form.currentPin,focused:o(e).show.removePinKeyboard,length:"4",onFocus:i.handle.focus.removePin},null,8,["value","focused","onFocus"]),r(b,{modelValue:o(e).form.currentPin,"onUpdate:modelValue":n[0]||(n[0]=a=>o(e).form.currentPin=a),show:o(e).show.removePinKeyboard},null,8,["modelValue","show"])]),_:1}),r(d,null,{default:t(()=>[r(y,{block:"",type:"danger",onClick:i.handle.removePin},{default:t(()=>n[9]||(n[9]=[f(" Confirm Remove ")])),_:1},8,["onClick"])]),_:1})]),_:1})):v("",!0)],64)):v("",!0),!o(e).hasPin||o(e).showPinForm?(u(),_(F,{key:1},[o(e).isChangingPin?(u(),K(c,{key:0,title:"Enter current PIN",style:{"padding-top":"10px","padding-bottom":"10px"}},{default:t(()=>[r(g,{value:o(e).form.currentPin,focused:o(e).show.currentPinKeyboard,length:"4",onFocus:i.handle.focus.currentPin},null,8,["value","focused","onFocus"]),r(b,{modelValue:o(e).form.currentPin,"onUpdate:modelValue":n[1]||(n[1]=a=>o(e).form.currentPin=a),show:o(e).show.currentPinKeyboard,onBlur:n[2]||(n[2]=a=>o(e).show.currentPinKeyboard=!1)},null,8,["modelValue","show"])]),_:1})):v("",!0),r(c,{title:o(m).translate("enter_your_pin_number"),style:{"padding-top":"10px","padding-bottom":"10px"}},{default:t(()=>[r(g,{value:o(e).form.pin,focused:o(e).show.pinKeyboard,length:"4",onFocus:i.handle.focus.pin},null,8,["value","focused","onFocus"]),r(b,{modelValue:o(e).form.pin,"onUpdate:modelValue":n[3]||(n[3]=a=>o(e).form.pin=a),show:o(e).show.pinKeyboard,onBlur:n[4]||(n[4]=a=>o(e).show.pinKeyboard=!1)},null,8,["modelValue","show"])]),_:1},8,["title"]),r(c,{title:o(m).translate("confirm_your_pin_number"),style:{"padding-top":"10px","padding-bottom":"10px"}},{default:t(()=>[r(g,{value:o(e).form.confirmPin,focused:o(e).show.confirmPinKeyboard,"error-info":o(e).errorInfo,length:"4",onFocus:i.handle.focus.confirmPin},null,8,["value","focused","error-info","onFocus"]),r(b,{modelValue:o(e).form.confirmPin,"onUpdate:modelValue":n[5]||(n[5]=a=>o(e).form.confirmPin=a),show:o(e).show.confirmPinKeyboard,onBlur:n[6]||(n[6]=a=>o(e).show.confirmPinKeyboard=!1)},null,8,["modelValue","show"])]),_:1},8,["title"]),r(d,null,{default:t(()=>[r(y,{block:"",type:"success",disabled:!o(h),onClick:k},{default:t(()=>[f(M(o(m).translate("save")),1)]),_:1},8,["disabled"])]),_:1})],64)):v("",!0)])}}}),me=$({__name:"pin",setup(U){const p=S(),P=A(!1),m=R();return B(async()=>{await m.loadFromSecureStorage(),P.value=!!m.pinCode}),(C,e)=>{const l=V,i=I,h=x,k=J;return u(),_("div",null,[o(P)?(u(),K(h,{key:0},{default:t(()=>[r(i,null,{default:t(()=>[r(l,{block:"",type:"primary",onClick:e[0]||(e[0]=s=>o(p).push("/settings/security/edit-pin"))},{default:t(()=>e[2]||(e[2]=[f(" Change PIN Number ")])),_:1})]),_:1}),r(i,null,{default:t(()=>[r(l,{block:"",type:"danger",onClick:e[1]||(e[1]=s=>o(p).push("/settings/security/delete-pin"))},{default:t(()=>e[3]||(e[3]=[f(" Remove PIN Number ")])),_:1})]),_:1})]),_:1})):(u(),K(k,{key:1}))])}}});export{me as default};
