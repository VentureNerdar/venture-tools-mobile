import{s as W}from"./IW4h0HQO.js";import{j as I,n as U,au as M,ay as V,bf as X,g as D,G as L,P as F,b6 as Y,b as n,as as q,aW as Z,az as ee,z,ar as ae,aH as te,r as P,s as oe,k as le,aQ as ne,v as se,y as O,c as re,w as y,U as a,o as ie,d as B,t as T,an as R}from"./DX7L8mW0.js";import{I as G}from"./ZaMcrE34.js";import{H as ue}from"./DRbOzoBI.js";import{s as ce}from"./C399Fyjm.js";import{s as de}from"./rOA6ctrY.js";import{s as me}from"./DBFB9YKp.js";import{s as ge}from"./BhXTN8q3.js";import{s as fe}from"./soJAr4A7.js";import"./Ctc7qOvh.js";/* empty css        *//* empty css        */import{P as pe,m as ve,u as ye,s as H}from"./DvxMi5gK.js";import{u as j}from"./2U1pBdZB.js";import{u as he}from"./B5QHbL8n.js";import{u as ke}from"./Dc9-n7Wd.js";import{u as _e,R as Ce}from"./0Ud42BVA.js";import{u as be}from"./BtNk9jBy.js";import{u as Se}from"./DsvMEa2q.js";import{L as we}from"./DQJyiHEB.js";import{w as Pe}from"./DkQH-hTN.js";import"./BdX5d0ox.js";import"./BbEgM1do.js";import"./CQxdcAm9.js";import"./CYA1mnle.js";import"./DlD6u9LM.js";import"./C0yiKs0t.js";import"./DVrzjvSN.js";import"./CP7Dlk6W.js";import"./-v2XyxJZ.js";let w=0;function Ve(e){e?(w||document.body.classList.add("van-toast--unclickable"),w++):w&&(w--,w||document.body.classList.remove("van-toast--unclickable"))}const[xe,k]=D("toast"),Ue=["show","overlay","teleport","transition","overlayClass","overlayStyle","closeOnClickOverlay","zIndex"],Oe={icon:String,show:Boolean,type:V("text"),overlay:Boolean,message:U,iconSize:U,duration:X(2e3),position:V("middle"),teleport:[String,Object],wordBreak:String,className:M,iconPrefix:String,transition:V("van-fade"),loadingType:String,forbidClick:Boolean,overlayClass:M,overlayStyle:Object,closeOnClick:Boolean,closeOnClickOverlay:Boolean,zIndex:U};var J=I({name:xe,props:Oe,emits:["update:show"],setup(e,{emit:t,slots:f}){let c,d=!1;const p=()=>{const i=e.show&&e.forbidClick;d!==i&&(d=i,Ve(d))},r=i=>t("update:show",i),m=()=>{e.closeOnClick&&r(!1)},l=()=>clearTimeout(c),C=()=>{const{icon:i,type:u,iconSize:s,iconPrefix:o,loadingType:v}=e;if(i||u==="success"||u==="fail")return n(G,{name:i||u,size:s,class:k("icon"),classPrefix:o},null);if(u==="loading")return n(we,{class:k("loading"),size:s,type:v},null)},b=()=>{const{type:i,message:u}=e;if(f.message)return n("div",{class:k("text")},[f.message()]);if(ee(u)&&u!=="")return i==="html"?n("div",{key:0,class:k("text"),innerHTML:String(u)},null):n("div",{class:k("text")},[u])};return L(()=>[e.show,e.forbidClick],p),L(()=>[e.show,e.type,e.message,e.duration],()=>{l(),e.show&&e.duration>0&&(c=setTimeout(()=>{r(!1)},e.duration))}),F(p),Y(p),()=>n(pe,q({class:[k([e.position,e.wordBreak==="normal"?"break-normal":e.wordBreak,{[e.type]:!e.icon}]),e.className],lockScroll:!1,onClick:m,onClosed:l,"onUpdate:show":r},Z(e,Ue)),{default:()=>[C(),b()]})}});const Be={icon:"",type:"text",message:"",className:"",overlay:!1,onClose:void 0,onOpened:void 0,duration:2e3,teleport:"body",iconSize:void 0,iconPrefix:void 0,position:"middle",transition:"van-fade",forbidClick:!1,loadingType:void 0,overlayClass:"",overlayStyle:void 0,closeOnClick:!1,closeOnClickOverlay:!1};let _=[],Te=!1,A=z({},Be);const Le=new Map;function K(e){return te(e)?e:{message:e}}function Ie(){const{instance:e}=ve({setup(){const t=P(""),{open:f,state:c,close:d,toggle:p}=ye(),r=()=>{},m=()=>n(J,q(c,{onClosed:r,"onUpdate:show":p}),null);return L(t,l=>{c.message=l}),oe().render=m,{open:f,close:d,message:t}}});return e}function ze(){if(!_.length||Te){const e=Ie();_.push(e)}return _[_.length-1]}function Ne(e={}){if(!ae)return{};const t=ze(),f=K(e);return t.open(z({},A,Le.get(f.type||A.type),f)),t}const $e=e=>t=>Ne(z({type:e},K(t))),Me=$e("loading"),Re=e=>{_.length&&_[0].close()};Pe(J);const[He,E]=D("tag"),je={size:String,mark:Boolean,show:le,type:V("default"),color:String,plain:Boolean,round:Boolean,textColor:String,closeable:Boolean};var Ae=I({name:He,props:je,emits:["close"],setup(e,{slots:t,emit:f}){const c=r=>{r.stopPropagation(),f("close",r)},d=()=>e.plain?{color:e.textColor||e.color,borderColor:e.color}:{color:e.textColor,background:e.color},p=()=>{var r;const{type:m,mark:l,plain:C,round:b,size:i,closeable:u}=e,s={mark:l,plain:C,round:b};i&&(s[i]=i);const o=u&&n(G,{name:"cross",class:[E("close"),ue],onClick:c},null);return n("span",{style:d(),class:E([s,m])},[(r=t.default)==null?void 0:r.call(t),o])};return()=>n(ne,{name:e.closeable?"van-fade":void 0},{default:()=>[e.show?p():null]})}});const ha=I({__name:"profile",setup(e){const t=Se(),f=se(),c=j(),d=P(!1),p=P([]),r=P(""),m={roles:O(()=>ke().userRoles),auth:j(),languageStore:he(),settingStore:be()},l=P({id:null,name:"",email:"",phone_number:"",biography:"",preferred_language_id:"",user_role_id:null,contact_id:null}),C=()=>{l.value.contact_id&&f.push({path:"/createForm",query:{moduleName:"Contacts",id:l.value.contact_id}})},b=O(()=>m.languageStore.languages.map(s=>({text:s.name,value:s.id})));F(async()=>{if(c.authUser&&(l.value={...c.authUser},l.value.preferred_language_id)){const s=m.languageStore.languages.find(o=>o.id===l.value.preferred_language_id);s&&(p.value=[s.id],r.value=s.name,m.languageStore.setUserPreferredLanguage(s))}});const i=O(()=>{var s;return(s=m.roles.value.find(o=>o.id===l.value.user_role_id))==null?void 0:s.label}),u={handle:{click:{logout:async()=>{Me({message:"Logging out...",forbidClick:!1,duration:0,overlay:!1,position:"middle",loadingType:"spinner"});try{await c.logout(),await m.settingStore.toggleBiometric(!1),await m.settingStore.removePinNumber(),f.replace("/"),H({type:"success",message:"See you again!",duration:3e3})}catch{H({type:"danger",message:"Logout failed. Please try again",duration:2e3})}finally{Re()}},confirmLanguage:({selectedOptions:s})=>{d.value=!1;const o=s[0];l.value.preferred_language_id=o.value,r.value=o.text,p.value=[o.value]},update:async()=>{var h;await(await _e(Ce.USERS,(h=c.authUser)==null?void 0:h.id)).save(l.value);const v={...c.authUser,...l.value};c.authUser=v,localStorage.setItem("authUser",JSON.stringify(v));const S=m.languageStore.languages.find(x=>x.id===l.value.preferred_language_id);S&&m.languageStore.setUserPreferredLanguage(S)}}}};return(s,o)=>{const v=W,S=Ae,h=ce,x=de,Q=me,N=ge,$=fe;return ie(),re("div",null,[n($,null,{default:y(()=>[n(v,{modelValue:a(l).name,"onUpdate:modelValue":o[0]||(o[0]=g=>a(l).name=g),label:a(t).translate("name"),placeholder:a(t).translate("name")},null,8,["modelValue","label","placeholder"]),n(h,{title:a(t).translate("user_role")},{value:y(()=>[n(S,{type:"primary"},{default:y(()=>[B(T(a(i)),1)]),_:1})]),_:1},8,["title"]),n(v,{modelValue:a(l).email,"onUpdate:modelValue":o[1]||(o[1]=g=>a(l).email=g),label:a(t).translate("email"),placeholder:a(t).translate("email")},null,8,["modelValue","label","placeholder"]),n(v,{modelValue:a(l).phone_number,"onUpdate:modelValue":o[2]||(o[2]=g=>a(l).phone_number=g),label:a(t).translate("phone"),placeholder:a(t).translate("phone")},null,8,["modelValue","label","placeholder"]),n(v,{modelValue:a(l).biography,"onUpdate:modelValue":o[3]||(o[3]=g=>a(l).biography=g),label:a(t).translate("biography"),placeholder:a(t).translate("biography")},null,8,["modelValue","label","placeholder"]),n(h,{title:a(t).translate("contact_profile"),"is-link":!!a(l).contact_id,value:a(l).contact_id?a(t).translate("go_to_contact_profile"):a(t).translate("no_contact_profile"),onClick:C},null,8,["title","is-link","value"]),n(v,{modelValue:a(r),"onUpdate:modelValue":o[4]||(o[4]=g=>R(r)?r.value=g:null),label:a(t).translate("language"),placeholder:a(t).translate("language"),"is-link":"",readonly:"",onClick:o[5]||(o[5]=g=>d.value=!0)},null,8,["modelValue","label","placeholder"]),n(Q,{show:a(d),"onUpdate:show":o[7]||(o[7]=g=>R(d)?d.value=g:null),position:"bottom",round:""},{default:y(()=>[n(x,{"model-value":a(p),title:"Languages",columns:a(b),onCancel:o[6]||(o[6]=g=>d.value=!1),onConfirm:u.handle.click.confirmLanguage},null,8,["model-value","columns","onConfirm"])]),_:1},8,["show"]),n(h,null,{default:y(()=>[n(N,{type:"primary",block:"",size:"small",onClick:u.handle.click.update},{default:y(()=>[B(T(a(t).translate("update")),1)]),_:1},8,["onClick"])]),_:1})]),_:1}),n($,{title:a(t).translate("authentication")},{default:y(()=>[n(h,{"is-link":"",title:a(t).translate("change_password")},null,8,["title"]),n(h,{title:a(t).translate("log_out")},{value:y(()=>[n(N,{type:"danger",size:"mini",plain:"",block:"",onClick:u.handle.click.logout},{default:y(()=>[B(T(a(t).translate("log_out")),1)]),_:1},8,["onClick"])]),_:1},8,["title"])]),_:1},8,["title"])])}}});export{ha as default};
